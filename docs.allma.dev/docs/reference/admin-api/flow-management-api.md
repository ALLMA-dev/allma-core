---
title: Flow Management API
---

# Flow Management API

These endpoints, generated by a standard CRUD handler, are used to create, read, update, and delete Flow definitions and their versions.

## Flow Master Records

A "master" record represents the flow as a whole, containing metadata like its name, description, and tracking its latest/published versions.

---

### List Flows

`GET /allma/flows`

Retrieves a list of all flow master records.

-   **Permission:** `DEFINITIONS_READ`
-   **Query Parameters:**
    -   `tag` (string, optional): Filter flows by a specific tag.
    -   `searchText` (string, optional): Perform a case-insensitive search on flow names and descriptions.
-   **Success Response:** `200 OK` with an array of flow metadata objects.

---

### Create Flow

`POST /allma/flows`

Creates a new flow master record and its initial `version 1`.

-   **Permission:** `DEFINITIONS_WRITE`
-   **Request Body:** A JSON object with the following properties:
    -   `name` (string, required): The name of the new flow.
    -   `description` (string, optional): A description for the flow.
-   **Example Request:**
    ```bash
    curl -X POST /allma/flows \
      -H "Authorization: Bearer <token>" \
      -d '{"name": "New Customer Onboarding", "description": "Handles new user signups."}'
    ```
-   **Success Response:** `201 Created` with the newly created flow metadata object.

---

### Get Flow

`GET /allma/flows/{flowId}`

Retrieves the master record for a single flow.

-   **Permission:** `DEFINITIONS_READ`
-   **Path Parameters:**
    -   `flowId` (string, required): The ID of the flow to retrieve.
-   **Success Response:** `200 OK` with the flow metadata object.

---

### Update Flow

`PUT /allma/flows/{flowId}`

Updates the metadata (name, description, tags) of a flow master record.

-   **Permission:** `DEFINITIONS_WRITE`
-   **Request Body:** A JSON object with properties to update (`name`, `description`, `tags`).
-   **Success Response:** `200 OK` with the updated flow metadata object.

---

### Clone Flow

`POST /allma/flows/{flowId}/clone`

Creates a new flow by cloning an existing one. The latest or published version of the source flow is used as the template for the new flow's `version 1`.

-   **Permission:** `DEFINITIONS_WRITE`
-   **Request Body:**
    -   `name` (string, required): The name for the new, cloned flow.
-   **Success Response:** `201 Created` with the metadata for the new flow.

## Flow Versions

---

### List Versions

`GET /allma/flows/{flowId}/versions`

Retrieves a list of all versions for a specific flow.

-   **Permission:** `DEFINITIONS_READ`
-   **Success Response:** `200 OK` with an array of version summary objects.

---

### Create Version

`POST /allma/flows/{flowId}/versions`

Creates a new draft version by cloning an existing version.

-   **Permission:** `DEFINITIONS_WRITE`
-   **Request Body:**
    -   `sourceVersion` (number | "latest", required): The version number to clone from, or `"latest"`.
-   **Success Response:** `201 Created` with the full definition of the new version.

---

### Get Version

`GET /allma/flows/{flowId}/versions/{versionNumber}`

Retrieves the full JSON definition for a specific version.

-   **Permission:** `DEFINITIONS_READ`
-   **Path Parameters:**
    -   `versionNumber` (number | "latest" | "LATEST_PUBLISHED"): The version to retrieve.
-   **Success Response:** `200 OK` with the complete `FlowDefinition` object.

---

### Update Version (PATCH)

`PUT /allma/flows/{flowId}/versions/{versionNumber}`

Updates a **draft** version of a flow. This endpoint uses a deep-merge strategy, allowing you to send partial updates (e.g., changing a single property on a single step). You cannot update a published version.

-   **Permission:** `DEFINITIONS_WRITE`
-   **Request Body:** A partial `FlowDefinition` object containing only the fields you want to change.
-   **Example Request (changing one step's display name):**
    ```bash
    curl -X PUT /allma/flows/{flowId}/versions/2 \
      -H "Authorization: Bearer <token>" \
      -d '{
        "steps": {
          "my_step_id": {
            "displayName": "New Updated Name"
          }
        }
      }'
    ```
-   **Success Response:** `200 OK` with the full, updated `FlowDefinition`.
-   **Error Response:** `409 Conflict` if you attempt to update a published version.

---

### Delete Version

`DELETE /allma/flows/{flowId}/versions/{versionNumber}`

Deletes a **draft** version. You cannot delete a published version or the only remaining version of a flow.

-   **Permission:** `DEFINITIONS_DELETE`
-   **Success Response:** `204 No Content`.

---

### Publish Version

`POST /allma/flows/{flowId}/versions/{versionNumber}/publish`

Publishes a specific version, making it the "live" version. Any previously published version will be automatically unpublished.

-   **Permission:** `DEFINITIONS_WRITE`
-   **Success Response:** `200 OK` with the updated `FlowDefinition` of the now-published version.

---

### Unpublish Version

`POST /allma/flows/{flowId}/versions/{versionNumber}/unpublish`

Unpublishes a version. The flow will have no "live" version until another is published.

-   **Permission:** `DEFINITIONS_WRITE`
-   **Success Response:** `200 OK` with the updated `FlowDefinition`.