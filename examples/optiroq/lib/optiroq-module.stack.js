"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.OptiroqModuleStack = void 0;
const cdk = __importStar(require("aws-cdk-lib"));
const dynamodb = __importStar(require("aws-cdk-lib/aws-dynamodb"));
const s3 = __importStar(require("aws-cdk-lib/aws-s3"));
const iam = __importStar(require("aws-cdk-lib/aws-iam"));
const lambda = __importStar(require("aws-cdk-lib/aws-lambda"));
const apigw = __importStar(require("aws-cdk-lib/aws-apigatewayv2"));
const acm = __importStar(require("aws-cdk-lib/aws-certificatemanager"));
const route53 = __importStar(require("aws-cdk-lib/aws-route53"));
const route53Targets = __importStar(require("aws-cdk-lib/aws-route53-targets"));
const aws_apigatewayv2_integrations_1 = require("aws-cdk-lib/aws-apigatewayv2-integrations");
const aws_cognito_1 = require("aws-cdk-lib/aws-cognito");
const aws_apigatewayv2_authorizers_1 = require("aws-cdk-lib/aws-apigatewayv2-authorizers");
const aws_lambda_nodejs_1 = require("aws-cdk-lib/aws-lambda-nodejs");
const path = __importStar(require("path"));
const web_app_deployment_js_1 = require("./constructs/web-app-deployment.js");
const cdk_nag_1 = require("cdk-nag");
const sqs = __importStar(require("aws-cdk-lib/aws-sqs"));
const cr = __importStar(require("aws-cdk-lib/custom-resources"));
const aws_logs_1 = require("aws-cdk-lib/aws-logs");
const fs = __importStar(require("fs"));
const util_dynamodb_1 = require("@aws-sdk/util-dynamodb");
const secretsmanager = __importStar(require("aws-cdk-lib/aws-secretsmanager"));
const events = __importStar(require("aws-cdk-lib/aws-events"));
const targets = __importStar(require("aws-cdk-lib/aws-events-targets"));
class OptiroqModuleStack extends cdk.Stack {
    constructor(scope, id, props) {
        super(scope, id, props);
        const { stageName, allmaOrchestrationRoleArn, stageConfig } = props;
        const isProd = stageConfig.stage === 'prod';
        const removalPolicy = isProd ? cdk.RemovalPolicy.RETAIN : cdk.RemovalPolicy.DESTROY;
        const coreStackExportPrefix = `AllmaPlatform-${stageConfig.stage}`;
        // --- Import Core Allma Resources ---
        const allmaFlowStartQueueArn = cdk.Fn.importValue(`${coreStackExportPrefix}-FlowStartRequestQueueArn`);
        const allmaFlowStartQueueUrl = cdk.Fn.importValue(`${coreStackExportPrefix}-FlowStartRequestQueueUrl`);
        const allmaFlowStartQueue = sqs.Queue.fromQueueArn(this, 'AllmaFlowStartQueue', allmaFlowStartQueueArn);
        // --- Optiroq Data Stores ---
        const entityGraphTable = new dynamodb.Table(this, 'OptiroqEntityGraph', {
            tableName: `OptiroqEntityGraph-${stageName}`,
            partitionKey: { name: 'PK', type: dynamodb.AttributeType.STRING },
            sortKey: { name: 'SK', type: dynamodb.AttributeType.STRING },
            billingMode: dynamodb.BillingMode.PAY_PER_REQUEST,
            removalPolicy,
            pointInTimeRecovery: isProd,
            stream: dynamodb.StreamViewType.NEW_AND_OLD_IMAGES,
        });
        entityGraphTable.addGlobalSecondaryIndex({
            indexName: 'GSI1',
            partitionKey: { name: 'GSI1PK', type: dynamodb.AttributeType.STRING },
            sortKey: { name: 'GSI1SK', type: dynamodb.AttributeType.STRING },
        });
        // GSI for querying suppliers by commodity.
        entityGraphTable.addGlobalSecondaryIndex({
            indexName: 'GSI2',
            partitionKey: { name: 'GSI2PK', type: dynamodb.AttributeType.STRING },
            sortKey: { name: 'GSI2SK', type: dynamodb.AttributeType.STRING },
        });
        // Table for storing currency exchange rates.
        const fxRatesTable = new dynamodb.Table(this, 'OptiroqFxRates', {
            tableName: `OptiroqFxRates-${stageName}`,
            partitionKey: { name: 'PK', type: dynamodb.AttributeType.STRING },
            sortKey: { name: 'SK', type: dynamodb.AttributeType.STRING },
            billingMode: dynamodb.BillingMode.PAY_PER_REQUEST,
            removalPolicy,
            timeToLiveAttribute: 'ttl', // Allows expiring old daily rates automatically.
        });
        const commodityPricesTable = new dynamodb.Table(this, 'OptiroqCommodityPrices', {
            tableName: `OptiroqCommodityPrices-${stageName}`,
            partitionKey: { name: 'PK', type: dynamodb.AttributeType.STRING },
            sortKey: { name: 'SK', type: dynamodb.AttributeType.STRING },
            billingMode: dynamodb.BillingMode.PAY_PER_REQUEST,
            removalPolicy,
        });
        const artefactsBucket = new s3.Bucket(this, 'ArtefactsBucket', {
            bucketName: `optiroq-artefacts-${this.account}-${stageName.toLowerCase()}`,
            encryption: s3.BucketEncryption.S3_MANAGED,
            versioned: isProd,
            removalPolicy,
            autoDeleteObjects: !isProd,
            blockPublicAccess: new s3.BlockPublicAccess({
                blockPublicAcls: true,
                ignorePublicAcls: true,
                blockPublicPolicy: false,
                restrictPublicBuckets: false,
            }),
        });
        artefactsBucket.addCorsRule({
            allowedMethods: [
                s3.HttpMethods.GET,
                s3.HttpMethods.POST,
                s3.HttpMethods.PUT,
                s3.HttpMethods.HEAD,
            ],
            allowedOrigins: stageConfig.optiroqApi.allowedOrigins,
            allowedHeaders: ['*'],
            exposedHeaders: ['ETag'],
        });
        // --- Initial Config Seeding (Master Field List & System Settings) ---
        const chunkArray = (array, size) => {
            const chunks = [];
            for (let i = 0; i < array.length; i += size) {
                chunks.push(array.slice(i, i + size));
            }
            return chunks;
        };
        // Seed Master Field List
        const masterFieldListPath = path.join(__dirname, '../config/master-fields.json');
        const masterFieldList = JSON.parse(fs.readFileSync(masterFieldListPath, 'utf8'));
        const masterFieldPutRequests = masterFieldList.map(field => ({
            PutRequest: { Item: (0, util_dynamodb_1.marshall)({ PK: 'CONFIG#MASTER_FIELD_LIST', SK: `FIELD#${field.key}`, entityType: 'CONFIGURATION_FIELD', ...field }) },
        }));
        chunkArray(masterFieldPutRequests, 25).forEach((chunk, chunkIndex) => {
            const sdkCall = {
                service: 'DynamoDB',
                action: 'batchWriteItem',
                parameters: { RequestItems: { [entityGraphTable.tableName]: chunk } },
                physicalResourceId: cr.PhysicalResourceId.of(`OptiroqMasterFieldListConfig-Chunk${chunkIndex + 1}`),
            };
            const customResource = new cr.AwsCustomResource(this, `MasterFieldListCustomResource-Chunk${chunkIndex + 1}`, {
                onCreate: sdkCall,
                onUpdate: sdkCall,
                logRetention: aws_logs_1.RetentionDays.ONE_WEEK,
                policy: cr.AwsCustomResourcePolicy.fromSdkCalls({ resources: [entityGraphTable.tableArn] }),
            });
            entityGraphTable.grantWriteData(customResource);
        });
        // Seed Supplier Field List
        const supplierFieldListPath = path.join(__dirname, '../config/supplier-fields.json');
        const supplierFieldList = JSON.parse(fs.readFileSync(supplierFieldListPath, 'utf8'));
        const supplierFieldPutRequests = supplierFieldList.map(field => ({
            PutRequest: { Item: (0, util_dynamodb_1.marshall)({ PK: 'CONFIG#SUPPLIER_FIELD_LIST', SK: `FIELD#${field.key}`, entityType: 'SUPPLIER_FIELD', ...field }) },
        }));
        chunkArray(supplierFieldPutRequests, 25).forEach((chunk, chunkIndex) => {
            const sdkCall = {
                service: 'DynamoDB', action: 'batchWriteItem',
                parameters: { RequestItems: { [entityGraphTable.tableName]: chunk } },
                physicalResourceId: cr.PhysicalResourceId.of(`OptiroqSupplierFieldListConfig-Chunk${chunkIndex + 1}`),
            };
            const customResource = new cr.AwsCustomResource(this, `SupplierFieldListCustomResource-Chunk${chunkIndex + 1}`, {
                onCreate: sdkCall, onUpdate: sdkCall, logRetention: aws_logs_1.RetentionDays.ONE_WEEK,
                policy: cr.AwsCustomResourcePolicy.fromSdkCalls({ resources: [entityGraphTable.tableArn] }),
            });
            entityGraphTable.grantWriteData(customResource);
        });
        // Seed Commodities List
        // Seed Commodities List (with new categorized structure)
        const commoditiesPath = path.join(__dirname, '../config/commodities.json');
        const categorizedCommodities = JSON.parse(fs.readFileSync(commoditiesPath, 'utf8'));
        const commodityPutRequests = categorizedCommodities.flatMap(category => category.commodities.map(commodity => ({
            PutRequest: {
                Item: (0, util_dynamodb_1.marshall)({
                    PK: 'CONFIG#COMMODITIES',
                    SK: `COMMODITY#${commodity.commodityId}`,
                    entityType: 'COMMODITY',
                    category: category.category,
                    categoryDescription: category.categoryDescription || null,
                    ...commodity,
                })
            },
        })));
        chunkArray(commodityPutRequests, 25).forEach((chunk, chunkIndex) => {
            const sdkCall = {
                service: 'DynamoDB', action: 'batchWriteItem',
                parameters: { RequestItems: { [entityGraphTable.tableName]: chunk } },
                physicalResourceId: cr.PhysicalResourceId.of(`OptiroqCommoditiesConfig-Chunk${chunkIndex + 1}`),
            };
            const customResource = new cr.AwsCustomResource(this, `CommoditiesCustomResource-Chunk${chunkIndex + 1}`, {
                onCreate: sdkCall, onUpdate: sdkCall, logRetention: aws_logs_1.RetentionDays.ONE_WEEK,
                policy: cr.AwsCustomResourcePolicy.fromSdkCalls({ resources: [entityGraphTable.tableArn] }),
            });
            entityGraphTable.grantWriteData(customResource);
        });
        // Seed System Settings for base units from a dedicated config file.
        const systemSettingsPath = path.join(__dirname, '../config/system-settings.json');
        const systemSettingsContent = fs.readFileSync(systemSettingsPath, 'utf8');
        const systemSettingsData = JSON.parse(systemSettingsContent);
        const systemSettings = {
            PK: 'CONFIG#SYSTEM_SETTINGS',
            SK: 'BASE_UNITS',
            entityType: 'CONFIGURATION',
            ...systemSettingsData,
        };
        const settingsSdkCall = {
            service: 'DynamoDB',
            action: 'putItem',
            parameters: {
                TableName: entityGraphTable.tableName,
                Item: (0, util_dynamodb_1.marshall)(systemSettings),
            },
            physicalResourceId: cr.PhysicalResourceId.of('OptiroqSystemSettingsConfig-v1'),
        };
        const settingsCustomResource = new cr.AwsCustomResource(this, 'SystemSettingsCustomResource', {
            onCreate: settingsSdkCall,
            onUpdate: settingsSdkCall,
            logRetention: aws_logs_1.RetentionDays.ONE_WEEK,
            policy: cr.AwsCustomResourcePolicy.fromSdkCalls({ resources: [entityGraphTable.tableArn] }),
        });
        entityGraphTable.grantWriteData(settingsCustomResource);
        // --- Cognito User Pool for Portal ---
        const userPool = new aws_cognito_1.UserPool(this, 'OptiroqUserPool', {
            userPoolName: `OptiroqPortalUsers-${stageName}`,
            selfSignUpEnabled: true,
            signInAliases: { email: true },
            removalPolicy,
        });
        const userPoolClient = new aws_cognito_1.UserPoolClient(this, 'OptiroqUserPoolClient', { userPool });
        // --- FX Rate Fetcher Service ---
        const fxApiKeySecret = secretsmanager.Secret.fromSecretNameV2(this, 'FxApiKeySecret', `OptiroqFxApiKey-${stageName}`);
        const commodityApiKeySecret = secretsmanager.Secret.fromSecretNameV2(this, 'CommodityApiKeySecret', `OptiroqCommodityApiKey-${stageName}`);
        const fxRateFetcherLambda = new aws_lambda_nodejs_1.NodejsFunction(this, 'FxRateFetcherLambda', {
            functionName: `optiroq-fxratefetcher-${stageName.toLowerCase()}`,
            runtime: lambda.Runtime.NODEJS_20_X,
            handler: 'handler',
            entry: path.join(__dirname, `../src/optiroq-lambdas/services/fx-rate-fetcher.handler.ts`),
            timeout: cdk.Duration.minutes(1),
            memorySize: 256,
            environment: {
                FX_RATES_TABLE: fxRatesTable.tableName,
                FX_API_KEY_SECRET_ARN: fxApiKeySecret.secretArn,
                FX_API_URL: 'https://v6.exchangerate-api.com/v6',
                BASE_CURRENCY: systemSettings.baseCurrency,
            },
            bundling: { externalModules: ['@aws-sdk/*'] },
        });
        fxRatesTable.grantWriteData(fxRateFetcherLambda);
        fxApiKeySecret.grantRead(fxRateFetcherLambda);
        new events.Rule(this, 'FxRateFetcherSchedule', {
            ruleName: `OptiroqFxRateFetcherSchedule-${stageName}`,
            schedule: events.Schedule.rate(cdk.Duration.days(1)),
            targets: [new targets.LambdaFunction(fxRateFetcherLambda)],
        });
        // --- Central IAM Role for Optiroq Lambdas ---
        const optiroqLambdaRole = new iam.Role(this, 'OptiroqLambdaRole', {
            assumedBy: new iam.ServicePrincipal('lambda.amazonaws.com'),
            managedPolicies: [iam.ManagedPolicy.fromAwsManagedPolicyName('service-role/AWSLambdaBasicExecutionRole')],
        });
        entityGraphTable.grantReadWriteData(optiroqLambdaRole);
        fxRatesTable.grantReadData(optiroqLambdaRole);
        commodityPricesTable.grantReadData(optiroqLambdaRole);
        artefactsBucket.grantReadWrite(optiroqLambdaRole);
        artefactsBucket.grantPut(optiroqLambdaRole, 'bom-uploads/*');
        artefactsBucket.grantPut(optiroqLambdaRole, 'rfq-uploads/*');
        allmaFlowStartQueue.grantSendMessages(optiroqLambdaRole);
        optiroqLambdaRole.addToPolicy(new iam.PolicyStatement({ actions: ['secretsmanager:GetSecretValue'], resources: ['*'] }));
        optiroqLambdaRole.addToPolicy(new iam.PolicyStatement({ actions: ['textract:*'], resources: ['*'] }));
        const allmaIncomingEmailsBucketName = `allma-incoming-emails-${this.account}-${stageName.toLowerCase()}`;
        const allmaExecutionTracesBucketName = `allma-execution-traces-${this.account}-${stageName.toLowerCase()}`;
        optiroqLambdaRole.addToPolicy(new iam.PolicyStatement({
            sid: 'AllowReadFromAllmaCoreBuckets',
            effect: iam.Effect.ALLOW,
            actions: ['s3:GetObject'],
            resources: [
                `arn:aws:s3:::${allmaIncomingEmailsBucketName}/*`,
                `arn:aws:s3:::${allmaExecutionTracesBucketName}/*`,
            ],
        }));
        // --- Lambda Layer & Factory Function ---
        const optiroqTypesLayer = new lambda.LayerVersion(this, 'OptiroqTypesLayer', {
            code: lambda.Code.fromAsset(path.join(__dirname, '../../../packages/optiroq-types')),
            compatibleRuntimes: [lambda.Runtime.NODEJS_20_X],
            description: 'Layer containing @optiroq/types for all Optiroq Lambdas',
        });
        const createLambda = (name, entry, timeout = cdk.Duration.seconds(30), environment = {}) => {
            return new aws_lambda_nodejs_1.NodejsFunction(this, `${name}Function`, {
                functionName: `optiroq-${name.toLowerCase()}-${stageName.toLowerCase()}`,
                runtime: lambda.Runtime.NODEJS_20_X,
                handler: 'handler',
                entry: path.join(__dirname, `../src/optiroq-lambdas/${entry}`),
                role: optiroqLambdaRole,
                timeout,
                memorySize: 512,
                environment: {
                    ENTITY_GRAPH_TABLE: entityGraphTable.tableName,
                    ARTEFACTS_BUCKET: artefactsBucket.bucketName,
                    ALLOWED_ORIGINS: props.stageConfig.optiroqApi.allowedOrigins.join(','),
                    ...environment,
                },
                layers: [optiroqTypesLayer],
                bundling: {
                    externalModules: ['@optiroq/types'],
                    minify: true,
                    sourceMap: true
                },
            });
        };
        // --- Lambda Definitions ---
        const parseAndCorrelateEmailLambda = createLambda('ParseAndCorrelateEmail', 'allma-steps/communication/parse-and-correlate-email.step.ts');
        const parseEmailAndLoadContextLambda = createLambda('ParseEmailAndLoadContext', 'allma-steps/process-supplier-quote/parse-email-and-load-context.step.ts');
        const sanitizeQuoteDocumentStepLambda = createLambda('SanitizeQuoteDocumentStep', 'allma-steps/process-supplier-quote/sanitize-quote-document.step.ts');
        const normalizeQuoteDataStepLambda = createLambda('NormalizeQuoteDataStep', 'allma-steps/process-supplier-quote/normalize-quote-data.step.ts', cdk.Duration.seconds(45), {
            FX_RATES_TABLE: fxRatesTable.tableName,
        });
        const generateComparisonBoardStepLambda = createLambda('GenerateComparisonBoardStep', 'allma-steps/generate-comparison-board.step.ts', cdk.Duration.minutes(1));
        const ruleBasedAnomalyCheckLambda = createLambda('RuleBasedAnomalyCheck', 'allma-steps/process-supplier-quote/rule-based-anomaly-check.step.ts');
        const riskScoreCalculationLambda = createLambda('RiskScoreCalculation', 'allma-steps/process-supplier-quote/risk-score-calculation.step.ts');
        const composeBatchWriteLambda = createLambda('ComposeBatchWrite', 'allma-steps/process-supplier-quote/compose-batch-write.step.ts');
        const extractWorkbookDataLambda = createLambda('ExtractWorkbookData', 'allma-steps/process-bom-upload/extract-workbook-data.step.ts', cdk.Duration.minutes(3));
        const extractDataFromBomLambda = createLambda('ExtractDataFromBom', 'allma-steps/process-bom-upload/extract-data-from-bom.step.ts');
        const mapAndValidateBomDataLambda = createLambda('MapAndValidateBomData', 'allma-steps/process-bom-upload/map-and-validate-bom-data.step.ts', cdk.Duration.minutes(1), {
            FX_RATES_TABLE: fxRatesTable.tableName,
        });
        const updateProjectWithBomDataLambda = createLambda('UpdateProjectWithBomData', 'allma-steps/process-bom-upload/update-project-with-bom-data.step.ts');
        const persistClassifiedPartLambda = createLambda('PersistClassifiedPart', 'allma-steps/process-bom-upload/persist-classified-part.step.ts', cdk.Duration.seconds(45));
        // Supplier Import Lambdas
        const mapAndValidateSupplierDataLambda = createLambda('MapAndValidateSupplierData', 'allma-steps/supplier-import/map-and-validate-supplier-data.step.ts', cdk.Duration.minutes(1));
        const reconcileSupplierCommoditiesLambda = createLambda('ReconcileSupplierCommodities', 'allma-steps/supplier-import/reconcile-supplier-commodities.step.ts');
        const persistSupplierLambda = createLambda('PersistSupplier', 'allma-steps/supplier-import/persist-supplier.step.ts', cdk.Duration.seconds(45));
        // RFQ Upload Flow Lambdas
        const sanitizeRfqDocumentExcelLambda = createLambda('SanitizeRfqDocumentExcel', 'allma-steps/rfq-upload/sanitize-rfq-document-excel.step.ts', cdk.Duration.minutes(2));
        const sanitizeRfqDocumentOcrLambda = createLambda('SanitizeRfqDocumentOcr', 'allma-steps/rfq-upload/sanitize-rfq-document-ocr.step.ts', cdk.Duration.minutes(2));
        const sanitizeRfqDocumentPptLambda = createLambda('SanitizeRfqDocumentPpt', 'allma-steps/rfq-upload/sanitize-rfq-document-ppt.step.ts');
        const validateAndSaveRfqDraftLambda = createLambda('ValidateAndSaveRfqDraft', 'allma-steps/rfq-upload/validate-and-save-rfq-draft.step.ts', cdk.Duration.minutes(1));
        const generateAttachmentLinksLambda = createLambda('GenerateAttachmentLinks', 'allma-steps/communication/generate-attachment-links.step.ts');
        const getViewApiHandler = createLambda('GetViewApiHandler', 'api/get-view.handler.ts', cdk.Duration.seconds(30), {
            FX_RATES_TABLE: fxRatesTable.tableName,
            COMMODITY_PRICES_TABLE: commodityPricesTable.tableName,
        });
        const postCommandApiHandler = createLambda('PostCommandApiHandler', 'api/post-command.handler.ts', cdk.Duration.seconds(30), {
            ALLMA_START_QUEUE_URL: allmaFlowStartQueueUrl,
            FX_RATES_TABLE: fxRatesTable.tableName,
        });
        const getUploadUrlApiHandler = createLambda('GetUploadUrlApiHandler', 'api/get-upload-url.handler.ts');
        const updateProjectAggregatesStreamLambda = createLambda('UpdateProjectAggregatesStream', 'streams/update-project-aggregates.stream.ts');
        updateProjectAggregatesStreamLambda.addEventSource(new cdk.aws_lambda_event_sources.DynamoEventSource(entityGraphTable, {
            startingPosition: lambda.StartingPosition.LATEST,
        }));
        // --- API Gateway Setup ---
        const authorizer = new aws_apigatewayv2_authorizers_1.HttpUserPoolAuthorizer('OptiroqCognitoAuthorizer', userPool, { userPoolClients: [userPoolClient] });
        const httpApi = new apigw.HttpApi(this, 'OptiroqHttpApi', { apiName: `OptiroqApi-${stageName}`, defaultAuthorizer: authorizer, createDefaultStage: false });
        const apiStage = new apigw.HttpStage(this, 'OptiroqApiStage', { httpApi, stageName: stageName, autoDeploy: true });
        const certificate = acm.Certificate.fromCertificateArn(this, 'OptiroqApiCert', stageConfig.optiroqApi.certificateArn);
        const domainName = new apigw.DomainName(this, 'OptiroqApiCustomDomain', { domainName: stageConfig.optiroqApi.domainName, certificate });
        new apigw.ApiMapping(this, 'OptiroqApiMapping', { api: httpApi, domainName: domainName, stage: apiStage });
        if (stageConfig.optiroqApi.hostedZoneId && stageConfig.optiroqApi.hostedZoneName) {
            const zone = route53.HostedZone.fromHostedZoneAttributes(this, 'OptiroqApiHostedZone', {
                hostedZoneId: stageConfig.optiroqApi.hostedZoneId,
                zoneName: stageConfig.optiroqApi.hostedZoneName,
            });
            new route53.ARecord(this, 'OptiroqApiDnsRecord', { zone: zone, recordName: stageConfig.optiroqApi.domainName, target: route53.RecordTarget.fromAlias(new route53Targets.ApiGatewayv2DomainProperties(domainName.regionalDomainName, domainName.regionalHostedZoneId)) });
        }
        const optiroqApiUrl = `https://${domainName.name}`;
        httpApi.addRoutes({ path: '/views/{viewName}', methods: [apigw.HttpMethod.GET], integration: new aws_apigatewayv2_integrations_1.HttpLambdaIntegration('GetViewListIntegration', getViewApiHandler) });
        httpApi.addRoutes({ path: '/views/{viewName}/{id}', methods: [apigw.HttpMethod.GET], integration: new aws_apigatewayv2_integrations_1.HttpLambdaIntegration('GetViewIntegration', getViewApiHandler) });
        httpApi.addRoutes({ path: '/commands/{entityType}', methods: [apigw.HttpMethod.POST], integration: new aws_apigatewayv2_integrations_1.HttpLambdaIntegration('PostCommandCreationIntegration', postCommandApiHandler) });
        httpApi.addRoutes({ path: '/commands/{entityType}/{id}', methods: [apigw.HttpMethod.POST], integration: new aws_apigatewayv2_integrations_1.HttpLambdaIntegration('PostCommandUpdateIntegration', postCommandApiHandler) });
        httpApi.addRoutes({ path: '/files/upload-url', methods: [apigw.HttpMethod.POST], integration: new aws_apigatewayv2_integrations_1.HttpLambdaIntegration('GetUploadUrlIntegration', getUploadUrlApiHandler), authorizer: authorizer });
        // --- Frontend Portal Deployment ---
        const webApp = new web_app_deployment_js_1.WebAppDeployment(this, 'PortalWebApp', {
            deploymentId: `OptiroqPortal-${stageName}`,
            assetPath: path.join(__dirname, '../src/portal-ui/dist'),
            runtimeConfig: {
                VITE_AWS_REGION: this.region,
                VITE_COGNITO_USER_POOL_ID: userPool.userPoolId,
                VITE_COGNITO_USER_POOL_CLIENT_ID: userPoolClient.userPoolClientId,
                VITE_API_BASE_URL: optiroqApiUrl,
            },
            domainName: stageConfig.optiroqPortal.domainName,
            certificateArn: stageConfig.optiroqPortal.certificateArn
        });
        // --- CORS Configuration ---
        const portalCloudFrontUrl = `https://${webApp.distribution.distributionDomainName}`;
        const finalOrigins = Array.from(new Set([...stageConfig.optiroqApi.allowedOrigins, portalCloudFrontUrl]));
        const cfnApi = httpApi.node.defaultChild;
        cfnApi.addPropertyOverride('CorsConfiguration', {
            AllowOrigins: finalOrigins,
            AllowMethods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],
            AllowHeaders: ['Content-Type', 'X-Amz-Date', 'Authorization', 'X-Api-Key', 'X-Amz-Security-Token', 'X-Amz-User-Agent'],
            MaxAge: 3600,
        });
        const allowedOriginsString = finalOrigins.join(',');
        [getViewApiHandler, postCommandApiHandler, getUploadUrlApiHandler].forEach(fn => {
            fn.addEnvironment('ALLOWED_ORIGINS', allowedOriginsString);
        });
        // --- Cross-Stack Permissions ---
        const allmaOrchestrationRole = iam.Role.fromRoleArn(this, 'AllmaOrchestrationRole', allmaOrchestrationRoleArn);
        const optiroqCustomStepLambdas = [
            generateAttachmentLinksLambda,
            parseAndCorrelateEmailLambda,
            parseEmailAndLoadContextLambda,
            sanitizeQuoteDocumentStepLambda, normalizeQuoteDataStepLambda, generateComparisonBoardStepLambda,
            extractWorkbookDataLambda, extractDataFromBomLambda, mapAndValidateBomDataLambda,
            updateProjectWithBomDataLambda, persistClassifiedPartLambda,
            // new quote processing lambdas
            ruleBasedAnomalyCheckLambda, riskScoreCalculationLambda, composeBatchWriteLambda,
            // supplier import lambdas
            mapAndValidateSupplierDataLambda, reconcileSupplierCommoditiesLambda, persistSupplierLambda,
            // RFQ upload lambdas
            sanitizeRfqDocumentExcelLambda, sanitizeRfqDocumentOcrLambda,
            sanitizeRfqDocumentPptLambda, validateAndSaveRfqDraftLambda,
        ];
        new iam.Policy(this, 'AllmaOptiroqInvokePolicy', {
            roles: [allmaOrchestrationRole],
            statements: [
                new iam.PolicyStatement({
                    sid: 'AllowAllmaToInvokeOptiroqLambdas',
                    effect: iam.Effect.ALLOW,
                    actions: ['lambda:InvokeFunction'],
                    resources: optiroqCustomStepLambdas.map(fn => fn.functionArn),
                }),
            ],
        });
        // --- CDK Outputs ---
        new cdk.CfnOutput(this, 'OptiroqEntityGraphTableName', { value: entityGraphTable.tableName });
        new cdk.CfnOutput(this, 'OptiroqArtefactsBucketName', { value: artefactsBucket.bucketName });
        new cdk.CfnOutput(this, 'OptiroqApiGatewayUrl', { value: domainName.regionalDomainName });
        new cdk.CfnOutput(this, 'OptiroqPortalUrl', { value: webApp.distribution.distributionDomainName });
        new cdk.CfnOutput(this, 'OptiroqFxRatesTableName', { value: fxRatesTable.tableName });
        new cdk.CfnOutput(this, 'OptiroqCommodityPricesTableName', { value: commodityPricesTable.tableName });
        // --- CDK Nag Suppressions ---
        cdk_nag_1.NagSuppressions.addStackSuppressions(this, [{ id: 'AwsSolutions-IAM4', reason: 'Using AWS managed policies for simplicity.' }]);
        cdk_nag_1.NagSuppressions.addStackSuppressions(this, [{ id: 'AwsSolutions-IAM5', reason: 'Wildcard permissions are used for brevity and within controlled scope.' }]);
    }
}
exports.OptiroqModuleStack = OptiroqModuleStack;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3B0aXJvcS1tb2R1bGUuc3RhY2suanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJvcHRpcm9xLW1vZHVsZS5zdGFjay50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxpREFBbUM7QUFFbkMsbUVBQXFEO0FBQ3JELHVEQUF5QztBQUN6Qyx5REFBMkM7QUFDM0MsK0RBQWlEO0FBQ2pELG9FQUFzRDtBQUN0RCx3RUFBMEQ7QUFDMUQsaUVBQW1EO0FBQ25ELGdGQUFrRTtBQUNsRSw2RkFBa0Y7QUFDbEYseURBQW1FO0FBQ25FLDJGQUFrRjtBQUNsRixxRUFBK0Q7QUFDL0QsMkNBQTZCO0FBRTdCLDhFQUFzRTtBQUN0RSxxQ0FBMEM7QUFDMUMseURBQTJDO0FBQzNDLGlFQUFtRDtBQUNuRCxtREFBcUQ7QUFDckQsdUNBQXlCO0FBQ3pCLDBEQUFrRDtBQUNsRCwrRUFBaUU7QUFDakUsK0RBQWlEO0FBQ2pELHdFQUEwRDtBQXdCMUQsTUFBYSxrQkFBbUIsU0FBUSxHQUFHLENBQUMsS0FBSztJQUM3QyxZQUFZLEtBQWdCLEVBQUUsRUFBVSxFQUFFLEtBQThCO1FBQ3BFLEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBRXhCLE1BQU0sRUFBRSxTQUFTLEVBQUUseUJBQXlCLEVBQUUsV0FBVyxFQUFFLEdBQUcsS0FBSyxDQUFDO1FBQ3BFLE1BQU0sTUFBTSxHQUFHLFdBQVcsQ0FBQyxLQUFLLEtBQUssTUFBTSxDQUFDO1FBQzVDLE1BQU0sYUFBYSxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDO1FBQ3BGLE1BQU0scUJBQXFCLEdBQUcsaUJBQWlCLFdBQVcsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUVuRSxzQ0FBc0M7UUFDdEMsTUFB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QUFDLENBQUM7UUFFdEcsK0JBQStCO1FBQy9CLHlCQUFlLENBQUMsb0JBQW9CLENBQUMsSUFBSSxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxFQUFFLDRDQUE0QyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ2hJLHlCQUFlLENBQUMsb0JBQW9CLENBQUMsSUFBSSxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxFQUFFLHdFQUF3RSxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ2hLLENBQUM7Q0FDSjtBQWxiRCxnREFrYkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBjZGsgZnJvbSAnYXdzLWNkay1saWInO1xyXG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tICdjb25zdHJ1Y3RzJztcclxuaW1wb3J0ICogYXMgZHluYW1vZGIgZnJvbSAnYXdzLWNkay1saWIvYXdzLWR5bmFtb2RiJztcclxuaW1wb3J0ICogYXMgczMgZnJvbSAnYXdzLWNkay1saWIvYXdzLXMzJztcclxuaW1wb3J0ICogYXMgaWFtIGZyb20gJ2F3cy1jZGstbGliL2F3cy1pYW0nO1xyXG5pbXBvcnQgKiBhcyBsYW1iZGEgZnJvbSAnYXdzLWNkay1saWIvYXdzLWxhbWJkYSc7XHJcbmltcG9ydCAqIGFzIGFwaWd3IGZyb20gJ2F3cy1jZGstbGliL2F3cy1hcGlnYXRld2F5djInO1xyXG5pbXBvcnQgKiBhcyBhY20gZnJvbSAnYXdzLWNkay1saWIvYXdzLWNlcnRpZmljYXRlbWFuYWdlcic7XHJcbmltcG9ydCAqIGFzIHJvdXRlNTMgZnJvbSAnYXdzLWNkay1saWIvYXdzLXJvdXRlNTMnO1xyXG5pbXBvcnQgKiBhcyByb3V0ZTUzVGFyZ2V0cyBmcm9tICdhd3MtY2RrLWxpYi9hd3Mtcm91dGU1My10YXJnZXRzJztcclxuaW1wb3J0IHsgSHR0cExhbWJkYUludGVncmF0aW9uIH0gZnJvbSAnYXdzLWNkay1saWIvYXdzLWFwaWdhdGV3YXl2Mi1pbnRlZ3JhdGlvbnMnO1xyXG5pbXBvcnQgeyBVc2VyUG9vbCwgVXNlclBvb2xDbGllbnQgfSBmcm9tICdhd3MtY2RrLWxpYi9hd3MtY29nbml0byc7XHJcbmltcG9ydCB7IEh0dHBVc2VyUG9vbEF1dGhvcml6ZXIgfSBmcm9tICdhd3MtY2RrLWxpYi9hd3MtYXBpZ2F0ZXdheXYyLWF1dGhvcml6ZXJzJztcclxuaW1wb3J0IHsgTm9kZWpzRnVuY3Rpb24gfSBmcm9tICdhd3MtY2RrLWxpYi9hd3MtbGFtYmRhLW5vZGVqcyc7XHJcbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XHJcbmltcG9ydCB7IFN0YWdlQ29uZmlnIH0gZnJvbSAnQGFsbG1hL2NvcmUtY2RrJztcclxuaW1wb3J0IHsgV2ViQXBwRGVwbG95bWVudCB9IGZyb20gJy4vY29uc3RydWN0cy93ZWItYXBwLWRlcGxveW1lbnQuanMnO1xyXG5pbXBvcnQgeyBOYWdTdXBwcmVzc2lvbnMgfSBmcm9tICdjZGstbmFnJztcclxuaW1wb3J0ICogYXMgc3FzIGZyb20gJ2F3cy1jZGstbGliL2F3cy1zcXMnO1xyXG5pbXBvcnQgKiBhcyBjciBmcm9tICdhd3MtY2RrLWxpYi9jdXN0b20tcmVzb3VyY2VzJztcclxuaW1wb3J0IHsgUmV0ZW50aW9uRGF5cyB9IGZyb20gJ2F3cy1jZGstbGliL2F3cy1sb2dzJztcclxuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xyXG5pbXBvcnQgeyBtYXJzaGFsbCB9IGZyb20gJ0Bhd3Mtc2RrL3V0aWwtZHluYW1vZGInO1xyXG5pbXBvcnQgKiBhcyBzZWNyZXRzbWFuYWdlciBmcm9tICdhd3MtY2RrLWxpYi9hd3Mtc2VjcmV0c21hbmFnZXInO1xyXG5pbXBvcnQgKiBhcyBldmVudHMgZnJvbSAnYXdzLWNkay1saWIvYXdzLWV2ZW50cyc7XHJcbmltcG9ydCAqIGFzIHRhcmdldHMgZnJvbSAnYXdzLWNkay1saWIvYXdzLWV2ZW50cy10YXJnZXRzJztcclxuaW1wb3J0IHsgU3lzdGVtU2V0dGluZ3MsIENvbW1vZGl0eSwgU3VwcGxpZXJGaWVsZCB9IGZyb20gJ0BvcHRpcm9xL3R5cGVzJztcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgT3B0aXJvcVN0YWdlQ29uZmlnIGV4dGVuZHMgU3RhZ2VDb25maWcge1xyXG4gICAgb3B0aXJvcUFwaToge1xyXG4gICAgICAgIGRvbWFpbk5hbWU6IHN0cmluZztcclxuICAgICAgICBjZXJ0aWZpY2F0ZUFybjogc3RyaW5nO1xyXG4gICAgICAgIGhvc3RlZFpvbmVJZD86IHN0cmluZztcclxuICAgICAgICBob3N0ZWRab25lTmFtZT86IHN0cmluZztcclxuICAgICAgICBhbGxvd2VkT3JpZ2luczogc3RyaW5nW11cclxuICAgIH0sXHJcbiAgICBvcHRpcm9xUG9ydGFsOiB7XHJcbiAgICAgICAgZG9tYWluTmFtZTogc3RyaW5nO1xyXG4gICAgICAgIGNlcnRpZmljYXRlQXJuOiBzdHJpbmc7XHJcbiAgICAgICAgaG9zdGVkWm9uZUlkPzogc3RyaW5nO1xyXG4gICAgfVxyXG59XHJcblxyXG5pbnRlcmZhY2UgT3B0aXJvcU1vZHVsZVN0YWNrUHJvcHMgZXh0ZW5kcyBjZGsuU3RhY2tQcm9wcyB7XHJcbiAgICBzdGFnZUNvbmZpZzogT3B0aXJvcVN0YWdlQ29uZmlnO1xyXG4gICAgc3RhZ2VOYW1lOiBzdHJpbmc7XHJcbiAgICBhbGxtYU9yY2hlc3RyYXRpb25Sb2xlQXJuOiBzdHJpbmc7XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBPcHRpcm9xTW9kdWxlU3RhY2sgZXh0ZW5kcyBjZGsuU3RhY2sge1xyXG4gICAgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZywgcHJvcHM6IE9wdGlyb3FNb2R1bGVTdGFja1Byb3BzKSB7XHJcbiAgICAgICAgc3VwZXIoc2NvcGUsIGlkLCBwcm9wcyk7XHJcblxyXG4gICAgICAgIGNvbnN0IHsgc3RhZ2VOYW1lLCBhbGxtYU9yY2hlc3RyYXRpb25Sb2xlQXJuLCBzdGFnZUNvbmZpZyB9ID0gcHJvcHM7XHJcbiAgICAgICAgY29uc3QgaXNQcm9kID0gc3RhZ2VDb25maWcuc3RhZ2UgPT09ICdwcm9kJztcclxuICAgICAgICBjb25zdCByZW1vdmFsUG9saWN5ID0gaXNQcm9kID8gY2RrLlJlbW92YWxQb2xpY3kuUkVUQUlOIDogY2RrLlJlbW92YWxQb2xpY3kuREVTVFJPWTtcclxuICAgICAgICBjb25zdCBjb3JlU3RhY2tFeHBvcnRQcmVmaXggPSBgQWxsbWFQbGF0Zm9ybS0ke3N0YWdlQ29uZmlnLnN0YWdlfWA7XHJcblxyXG4gICAgICAgIC8vIC0tLSBJbXBvcnQgQ29yZSBBbGxtYSBSZXNvdXJjZXMgLS0tXHJcbiAgICAgICAgY29uc3QgYWxsbWFGbG93U3RhcnRRdWV1ZUFybiA9IGNkay5Gbi5pbXBvcnRWYWx1ZShgJHtjb3JlU3RhY2tFeHBvcnRQcmVmaXh9LUZsb3dTdGFydFJlcXVlc3RRdWV1ZUFybmApO1xyXG4gICAgICAgIGNvbnN0IGFsbG1hRmxvd1N0YXJ0UXVldWVVcmwgPSBjZGsuRm4uaW1wb3J0VmFsdWUoYCR7Y29yZVN0YWNrRXhwb3J0UHJlZml4fS1GbG93U3RhcnRSZXF1ZXN0UXVldWVVcmxgKTtcclxuICAgICAgICBjb25zdCBhbGxtYUZsb3dTdGFydFF1ZXVlID0gc3FzLlF1ZXVlLmZyb21RdWV1ZUFybih0aGlzLCAnQWxsbWFGbG93U3RhcnRRdWV1ZScsIGFsbG1hRmxvd1N0YXJ0UXVldWVBcm4pO1xyXG5cclxuICAgICAgICAvLyAtLS0gT3B0aXJvcSBEYXRhIFN0b3JlcyAtLS1cclxuICAgICAgICBjb25zdCBlbnRpdHlHcmFwaFRhYmxlID0gbmV3IGR5bmFtb2RiLlRhYmxlKHRoaXMsICdPcHRpcm9xRW50aXR5R3JhcGgnLCB7XHJcbiAgICAgICAgICAgIHRhYmxlTmFtZTogYE9wdGlyb3FFbnRpdHlHcmFwaC0ke3N0YWdlTmFtZX1gLFxyXG4gICAgICAgICAgICBwYXJ0aXRpb25LZXk6IHsgbmFtZTogJ1BLJywgdHlwZTogZHluYW1vZGIuQXR0cmlidXRlVHlwZS5TVFJJTkcgfSxcclxuICAgICAgICAgICAgc29ydEtleTogeyBuYW1lOiAnU0snLCB0eXBlOiBkeW5hbW9kYi5BdHRyaWJ1dGVUeXBlLlNUUklORyB9LFxyXG4gICAgICAgICAgICBiaWxsaW5nTW9kZTogZHluYW1vZGIuQmlsbGluZ01vZGUuUEFZX1BFUl9SRVFVRVNULFxyXG4gICAgICAgICAgICByZW1vdmFsUG9saWN5LFxyXG4gICAgICAgICAgICBwb2ludEluVGltZVJlY292ZXJ5OiBpc1Byb2QsXHJcbiAgICAgICAgICAgIHN0cmVhbTogZHluYW1vZGIuU3RyZWFtVmlld1R5cGUuTkVXX0FORF9PTERfSU1BR0VTLFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBlbnRpdHlHcmFwaFRhYmxlLmFkZEdsb2JhbFNlY29uZGFyeUluZGV4KHtcclxuICAgICAgICAgICAgaW5kZXhOYW1lOiAnR1NJMScsXHJcbiAgICAgICAgICAgIHBhcnRpdGlvbktleTogeyBuYW1lOiAnR1NJMVBLJywgdHlwZTogZHluYW1vZGIuQXR0cmlidXRlVHlwZS5TVFJJTkcgfSxcclxuICAgICAgICAgICAgc29ydEtleTogeyBuYW1lOiAnR1NJMVNLJywgdHlwZTogZHluYW1vZGIuQXR0cmlidXRlVHlwZS5TVFJJTkcgfSxcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gR1NJIGZvciBxdWVyeWluZyBzdXBwbGllcnMgYnkgY29tbW9kaXR5LlxyXG4gICAgICAgIGVudGl0eUdyYXBoVGFibGUuYWRkR2xvYmFsU2Vjb25kYXJ5SW5kZXgoe1xyXG4gICAgICAgICAgICBpbmRleE5hbWU6ICdHU0kyJyxcclxuICAgICAgICAgICAgcGFydGl0aW9uS2V5OiB7IG5hbWU6ICdHU0kyUEsnLCB0eXBlOiBkeW5hbW9kYi5BdHRyaWJ1dGVUeXBlLlNUUklORyB9LFxyXG4gICAgICAgICAgICBzb3J0S2V5OiB7IG5hbWU6ICdHU0kyU0snLCB0eXBlOiBkeW5hbW9kYi5BdHRyaWJ1dGVUeXBlLlNUUklORyB9LFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBUYWJsZSBmb3Igc3RvcmluZyBjdXJyZW5jeSBleGNoYW5nZSByYXRlcy5cclxuICAgICAgICBjb25zdCBmeFJhdGVzVGFibGUgPSBuZXcgZHluYW1vZGIuVGFibGUodGhpcywgJ09wdGlyb3FGeFJhdGVzJywge1xyXG4gICAgICAgICAgICB0YWJsZU5hbWU6IGBPcHRpcm9xRnhSYXRlcy0ke3N0YWdlTmFtZX1gLFxyXG4gICAgICAgICAgICBwYXJ0aXRpb25LZXk6IHsgbmFtZTogJ1BLJywgdHlwZTogZHluYW1vZGIuQXR0cmlidXRlVHlwZS5TVFJJTkcgfSxcclxuICAgICAgICAgICAgc29ydEtleTogeyBuYW1lOiAnU0snLCB0eXBlOiBkeW5hbW9kYi5BdHRyaWJ1dGVUeXBlLlNUUklORyB9LFxyXG4gICAgICAgICAgICBiaWxsaW5nTW9kZTogZHluYW1vZGIuQmlsbGluZ01vZGUuUEFZX1BFUl9SRVFVRVNULFxyXG4gICAgICAgICAgICByZW1vdmFsUG9saWN5LFxyXG4gICAgICAgICAgICB0aW1lVG9MaXZlQXR0cmlidXRlOiAndHRsJywgLy8gQWxsb3dzIGV4cGlyaW5nIG9sZCBkYWlseSByYXRlcyBhdXRvbWF0aWNhbGx5LlxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBjb25zdCBjb21tb2RpdHlQcmljZXNUYWJsZSA9IG5ldyBkeW5hbW9kYi5UYWJsZSh0aGlzLCAnT3B0aXJvcUNvbW1vZGl0eVByaWNlcycsIHtcclxuICAgICAgICAgICAgdGFibGVOYW1lOiBgT3B0aXJvcUNvbW1vZGl0eVByaWNlcy0ke3N0YWdlTmFtZX1gLFxyXG4gICAgICAgICAgICBwYXJ0aXRpb25LZXk6IHsgbmFtZTogJ1BLJywgdHlwZTogZHluYW1vZGIuQXR0cmlidXRlVHlwZS5TVFJJTkcgfSxcclxuICAgICAgICAgICAgc29ydEtleTogeyBuYW1lOiAnU0snLCB0eXBlOiBkeW5hbW9kYi5BdHRyaWJ1dGVUeXBlLlNUUklORyB9LFxyXG4gICAgICAgICAgICBiaWxsaW5nTW9kZTogZHluYW1vZGIuQmlsbGluZ01vZGUuUEFZX1BFUl9SRVFVRVNULFxyXG4gICAgICAgICAgICByZW1vdmFsUG9saWN5LFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBjb25zdCBhcnRlZmFjdHNCdWNrZXQgPSBuZXcgczMuQnVja2V0KHRoaXMsICdBcnRlZmFjdHNCdWNrZXQnLCB7XHJcbiAgICAgICAgICAgIGJ1Y2tldE5hbWU6IGBvcHRpcm9xLWFydGVmYWN0cy0ke3RoaXMuYWNjb3VudH0tJHtzdGFnZU5hbWUudG9Mb3dlckNhc2UoKX1gLFxyXG4gICAgICAgICAgICBlbmNyeXB0aW9uOiBzMy5CdWNrZXRFbmNyeXB0aW9uLlMzX01BTkFHRUQsXHJcbiAgICAgICAgICAgIHZlcnNpb25lZDogaXNQcm9kLFxyXG4gICAgICAgICAgICByZW1vdmFsUG9saWN5LFxyXG4gICAgICAgICAgICBhdXRvRGVsZXRlT2JqZWN0czogIWlzUHJvZCxcclxuICAgICAgICAgICAgYmxvY2tQdWJsaWNBY2Nlc3M6IG5ldyBzMy5CbG9ja1B1YmxpY0FjY2Vzcyh7XHJcbiAgICAgICAgICAgICAgICBibG9ja1B1YmxpY0FjbHM6IHRydWUsXHJcbiAgICAgICAgICAgICAgICBpZ25vcmVQdWJsaWNBY2xzOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgYmxvY2tQdWJsaWNQb2xpY3k6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgcmVzdHJpY3RQdWJsaWNCdWNrZXRzOiBmYWxzZSxcclxuICAgICAgICAgICAgfSksXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGFydGVmYWN0c0J1Y2tldC5hZGRDb3JzUnVsZSh7XHJcbiAgICAgICAgICAgIGFsbG93ZWRNZXRob2RzOiBbXHJcbiAgICAgICAgICAgICAgICBzMy5IdHRwTWV0aG9kcy5HRVQsXHJcbiAgICAgICAgICAgICAgICBzMy5IdHRwTWV0aG9kcy5QT1NULFxyXG4gICAgICAgICAgICAgICAgczMuSHR0cE1ldGhvZHMuUFVULFxyXG4gICAgICAgICAgICAgICAgczMuSHR0cE1ldGhvZHMuSEVBRCxcclxuICAgICAgICAgICAgXSxcclxuICAgICAgICAgICAgYWxsb3dlZE9yaWdpbnM6IHN0YWdlQ29uZmlnLm9wdGlyb3FBcGkuYWxsb3dlZE9yaWdpbnMsXHJcbiAgICAgICAgICAgIGFsbG93ZWRIZWFkZXJzOiBbJyonXSxcclxuICAgICAgICAgICAgZXhwb3NlZEhlYWRlcnM6IFsnRVRhZyddLFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyAtLS0gSW5pdGlhbCBDb25maWcgU2VlZGluZyAoTWFzdGVyIEZpZWxkIExpc3QgJiBTeXN0ZW0gU2V0dGluZ3MpIC0tLVxyXG4gICAgICAgIGNvbnN0IGNodW5rQXJyYXkgPSA8VD4oYXJyYXk6IFRbXSwgc2l6ZTogbnVtYmVyKTogVFtdW10gPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBjaHVua3M6IFRbXVtdID0gW107XHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyBpICs9IHNpemUpIHsgY2h1bmtzLnB1c2goYXJyYXkuc2xpY2UoaSwgaSArIHNpemUpKTsgfVxyXG4gICAgICAgICAgICByZXR1cm4gY2h1bmtzO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIFNlZWQgTWFzdGVyIEZpZWxkIExpc3RcclxuICAgICAgICBjb25zdCBtYXN0ZXJGaWVsZExpc3RQYXRoID0gcGF0aC5qb2luKF9fZGlybmFtZSwgJy4uL2NvbmZpZy9tYXN0ZXItZmllbGRzLmpzb24nKTtcclxuICAgICAgICBjb25zdCBtYXN0ZXJGaWVsZExpc3Q6IGFueVtdID0gSlNPTi5wYXJzZShmcy5yZWFkRmlsZVN5bmMobWFzdGVyRmllbGRMaXN0UGF0aCwgJ3V0ZjgnKSk7XHJcbiAgICAgICAgY29uc3QgbWFzdGVyRmllbGRQdXRSZXF1ZXN0cyA9IG1hc3RlckZpZWxkTGlzdC5tYXAoZmllbGQgPT4gKHtcclxuICAgICAgICAgICAgUHV0UmVxdWVzdDogeyBJdGVtOiBtYXJzaGFsbCh7IFBLOiAnQ09ORklHI01BU1RFUl9GSUVMRF9MSVNUJywgU0s6IGBGSUVMRCMke2ZpZWxkLmtleX1gLCBlbnRpdHlUeXBlOiAnQ09ORklHVVJBVElPTl9GSUVMRCcsIC4uLmZpZWxkIH0pIH0sXHJcbiAgICAgICAgfSkpO1xyXG4gICAgICAgIGNodW5rQXJyYXkobWFzdGVyRmllbGRQdXRSZXF1ZXN0cywgMjUpLmZvckVhY2goKGNodW5rLCBjaHVua0luZGV4KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNka0NhbGw6IGNyLkF3c1Nka0NhbGwgPSB7XHJcbiAgICAgICAgICAgICAgICBzZXJ2aWNlOiAnRHluYW1vREInLFxyXG4gICAgICAgICAgICAgICAgYWN0aW9uOiAnYmF0Y2hXcml0ZUl0ZW0nLFxyXG4gICAgICAgICAgICAgICAgcGFyYW1ldGVyczogeyBSZXF1ZXN0SXRlbXM6IHsgW2VudGl0eUdyYXBoVGFibGUudGFibGVOYW1lXTogY2h1bmsgfSB9LFxyXG4gICAgICAgICAgICAgICAgcGh5c2ljYWxSZXNvdXJjZUlkOiBjci5QaHlzaWNhbFJlc291cmNlSWQub2YoYE9wdGlyb3FNYXN0ZXJGaWVsZExpc3RDb25maWctQ2h1bmske2NodW5rSW5kZXggKyAxfWApLFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBjb25zdCBjdXN0b21SZXNvdXJjZSA9IG5ldyBjci5Bd3NDdXN0b21SZXNvdXJjZSh0aGlzLCBgTWFzdGVyRmllbGRMaXN0Q3VzdG9tUmVzb3VyY2UtQ2h1bmske2NodW5rSW5kZXggKyAxfWAsIHtcclxuICAgICAgICAgICAgICAgIG9uQ3JlYXRlOiBzZGtDYWxsLFxyXG4gICAgICAgICAgICAgICAgb25VcGRhdGU6IHNka0NhbGwsXHJcbiAgICAgICAgICAgICAgICBsb2dSZXRlbnRpb246IFJldGVudGlvbkRheXMuT05FX1dFRUssXHJcbiAgICAgICAgICAgICAgICBwb2xpY3k6IGNyLkF3c0N1c3RvbVJlc291cmNlUG9saWN5LmZyb21TZGtDYWxscyh7IHJlc291cmNlczogW2VudGl0eUdyYXBoVGFibGUudGFibGVBcm5dIH0pLFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgZW50aXR5R3JhcGhUYWJsZS5ncmFudFdyaXRlRGF0YShjdXN0b21SZXNvdXJjZSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIFNlZWQgU3VwcGxpZXIgRmllbGQgTGlzdFxyXG4gICAgICAgIGNvbnN0IHN1cHBsaWVyRmllbGRMaXN0UGF0aCA9IHBhdGguam9pbihfX2Rpcm5hbWUsICcuLi9jb25maWcvc3VwcGxpZXItZmllbGRzLmpzb24nKTtcclxuICAgICAgICBjb25zdCBzdXBwbGllckZpZWxkTGlzdDogU3VwcGxpZXJGaWVsZFtdID0gSlNPTi5wYXJzZShmcy5yZWFkRmlsZVN5bmMoc3VwcGxpZXJGaWVsZExpc3RQYXRoLCAndXRmOCcpKTtcclxuICAgICAgICBjb25zdCBzdXBwbGllckZpZWxkUHV0UmVxdWVzdHMgPSBzdXBwbGllckZpZWxkTGlzdC5tYXAoZmllbGQgPT4gKHtcclxuICAgICAgICAgICAgUHV0UmVxdWVzdDogeyBJdGVtOiBtYXJzaGFsbCh7IFBLOiAnQ09ORklHI1NVUFBMSUVSX0ZJRUxEX0xJU1QnLCBTSzogYEZJRUxEIyR7ZmllbGQua2V5fWAsIGVudGl0eVR5cGU6ICdTVVBQTElFUl9GSUVMRCcsIC4uLmZpZWxkIH0pIH0sXHJcbiAgICAgICAgfSkpO1xyXG4gICAgICAgIGNodW5rQXJyYXkoc3VwcGxpZXJGaWVsZFB1dFJlcXVlc3RzLCAyNSkuZm9yRWFjaCgoY2h1bmssIGNodW5rSW5kZXgpID0+IHtcclxuICAgICAgICAgICAgY29uc3Qgc2RrQ2FsbDogY3IuQXdzU2RrQ2FsbCA9IHtcclxuICAgICAgICAgICAgICAgIHNlcnZpY2U6ICdEeW5hbW9EQicsIGFjdGlvbjogJ2JhdGNoV3JpdGVJdGVtJyxcclxuICAgICAgICAgICAgICAgIHBhcmFtZXRlcnM6IHsgUmVxdWVzdEl0ZW1zOiB7IFtlbnRpdHlHcmFwaFRhYmxlLnRhYmxlTmFtZV06IGNodW5rIH0gfSxcclxuICAgICAgICAgICAgICAgIHBoeXNpY2FsUmVzb3VyY2VJZDogY3IuUGh5c2ljYWxSZXNvdXJjZUlkLm9mKGBPcHRpcm9xU3VwcGxpZXJGaWVsZExpc3RDb25maWctQ2h1bmske2NodW5rSW5kZXggKyAxfWApLFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBjb25zdCBjdXN0b21SZXNvdXJjZSA9IG5ldyBjci5Bd3NDdXN0b21SZXNvdXJjZSh0aGlzLCBgU3VwcGxpZXJGaWVsZExpc3RDdXN0b21SZXNvdXJjZS1DaHVuayR7Y2h1bmtJbmRleCArIDF9YCwge1xyXG4gICAgICAgICAgICAgICAgb25DcmVhdGU6IHNka0NhbGwsIG9uVXBkYXRlOiBzZGtDYWxsLCBsb2dSZXRlbnRpb246IFJldGVudGlvbkRheXMuT05FX1dFRUssXHJcbiAgICAgICAgICAgICAgICBwb2xpY3k6IGNyLkF3c0N1c3RvbVJlc291cmNlUG9saWN5LmZyb21TZGtDYWxscyh7IHJlc291cmNlczogW2VudGl0eUdyYXBoVGFibGUudGFibGVBcm5dIH0pLFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgZW50aXR5R3JhcGhUYWJsZS5ncmFudFdyaXRlRGF0YShjdXN0b21SZXNvdXJjZSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIFNlZWQgQ29tbW9kaXRpZXMgTGlzdFxyXG4gICAgICAgIC8vIFNlZWQgQ29tbW9kaXRpZXMgTGlzdCAod2l0aCBuZXcgY2F0ZWdvcml6ZWQgc3RydWN0dXJlKVxyXG4gICAgICAgIGNvbnN0IGNvbW1vZGl0aWVzUGF0aCA9IHBhdGguam9pbihfX2Rpcm5hbWUsICcuLi9jb25maWcvY29tbW9kaXRpZXMuanNvbicpO1xyXG4gICAgICAgIGNvbnN0IGNhdGVnb3JpemVkQ29tbW9kaXRpZXM6IHsgY2F0ZWdvcnk6IHN0cmluZzsgY2F0ZWdvcnlEZXNjcmlwdGlvbj86IHN0cmluZzsgY29tbW9kaXRpZXM6IE9taXQ8Q29tbW9kaXR5LCAnUEsnIHwgJ1NLJyB8ICdlbnRpdHlUeXBlJyB8ICdjYXRlZ29yeScgfCAnY2F0ZWdvcnlEZXNjcmlwdGlvbic+W10gfVtdID0gSlNPTi5wYXJzZShmcy5yZWFkRmlsZVN5bmMoY29tbW9kaXRpZXNQYXRoLCAndXRmOCcpKTtcclxuXHJcbiAgICAgICAgY29uc3QgY29tbW9kaXR5UHV0UmVxdWVzdHMgPSBjYXRlZ29yaXplZENvbW1vZGl0aWVzLmZsYXRNYXAoY2F0ZWdvcnkgPT5cclxuICAgICAgICAgICAgY2F0ZWdvcnkuY29tbW9kaXRpZXMubWFwKGNvbW1vZGl0eSA9PiAoe1xyXG4gICAgICAgICAgICAgICAgUHV0UmVxdWVzdDoge1xyXG4gICAgICAgICAgICAgICAgICAgIEl0ZW06IG1hcnNoYWxsKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgUEs6ICdDT05GSUcjQ09NTU9ESVRJRVMnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBTSzogYENPTU1PRElUWSMke2NvbW1vZGl0eS5jb21tb2RpdHlJZH1gLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbnRpdHlUeXBlOiAnQ09NTU9ESVRZJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2F0ZWdvcnk6IGNhdGVnb3J5LmNhdGVnb3J5LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXRlZ29yeURlc2NyaXB0aW9uOiBjYXRlZ29yeS5jYXRlZ29yeURlc2NyaXB0aW9uIHx8IG51bGwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLmNvbW1vZGl0eSxcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgfSkpXHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgY2h1bmtBcnJheShjb21tb2RpdHlQdXRSZXF1ZXN0cywgMjUpLmZvckVhY2goKGNodW5rLCBjaHVua0luZGV4KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNka0NhbGw6IGNyLkF3c1Nka0NhbGwgPSB7XHJcbiAgICAgICAgICAgICAgICBzZXJ2aWNlOiAnRHluYW1vREInLCBhY3Rpb246ICdiYXRjaFdyaXRlSXRlbScsXHJcbiAgICAgICAgICAgICAgICBwYXJhbWV0ZXJzOiB7IFJlcXVlc3RJdGVtczogeyBbZW50aXR5R3JhcGhUYWJsZS50YWJsZU5hbWVdOiBjaHVuayB9IH0sXHJcbiAgICAgICAgICAgICAgICBwaHlzaWNhbFJlc291cmNlSWQ6IGNyLlBoeXNpY2FsUmVzb3VyY2VJZC5vZihgT3B0aXJvcUNvbW1vZGl0aWVzQ29uZmlnLUNodW5rJHtjaHVua0luZGV4ICsgMX1gKSxcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgY29uc3QgY3VzdG9tUmVzb3VyY2UgPSBuZXcgY3IuQXdzQ3VzdG9tUmVzb3VyY2UodGhpcywgYENvbW1vZGl0aWVzQ3VzdG9tUmVzb3VyY2UtQ2h1bmske2NodW5rSW5kZXggKyAxfWAsIHtcclxuICAgICAgICAgICAgICAgIG9uQ3JlYXRlOiBzZGtDYWxsLCBvblVwZGF0ZTogc2RrQ2FsbCwgbG9nUmV0ZW50aW9uOiBSZXRlbnRpb25EYXlzLk9ORV9XRUVLLFxyXG4gICAgICAgICAgICAgICAgcG9saWN5OiBjci5Bd3NDdXN0b21SZXNvdXJjZVBvbGljeS5mcm9tU2RrQ2FsbHMoeyByZXNvdXJjZXM6IFtlbnRpdHlHcmFwaFRhYmxlLnRhYmxlQXJuXSB9KSxcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGVudGl0eUdyYXBoVGFibGUuZ3JhbnRXcml0ZURhdGEoY3VzdG9tUmVzb3VyY2UpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBTZWVkIFN5c3RlbSBTZXR0aW5ncyBmb3IgYmFzZSB1bml0cyBmcm9tIGEgZGVkaWNhdGVkIGNvbmZpZyBmaWxlLlxyXG4gICAgICAgIGNvbnN0IHN5c3RlbVNldHRpbmdzUGF0aCA9IHBhdGguam9pbihfX2Rpcm5hbWUsICcuLi9jb25maWcvc3lzdGVtLXNldHRpbmdzLmpzb24nKTtcclxuICAgICAgICBjb25zdCBzeXN0ZW1TZXR0aW5nc0NvbnRlbnQgPSBmcy5yZWFkRmlsZVN5bmMoc3lzdGVtU2V0dGluZ3NQYXRoLCAndXRmOCcpO1xyXG4gICAgICAgIGNvbnN0IHN5c3RlbVNldHRpbmdzRGF0YSA9IEpTT04ucGFyc2Uoc3lzdGVtU2V0dGluZ3NDb250ZW50KTtcclxuXHJcbiAgICAgICAgY29uc3Qgc3lzdGVtU2V0dGluZ3M6IFN5c3RlbVNldHRpbmdzID0ge1xyXG4gICAgICAgICAgICBQSzogJ0NPTkZJRyNTWVNURU1fU0VUVElOR1MnLFxyXG4gICAgICAgICAgICBTSzogJ0JBU0VfVU5JVFMnLFxyXG4gICAgICAgICAgICBlbnRpdHlUeXBlOiAnQ09ORklHVVJBVElPTicsXHJcbiAgICAgICAgICAgIC4uLnN5c3RlbVNldHRpbmdzRGF0YSxcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IHNldHRpbmdzU2RrQ2FsbDogY3IuQXdzU2RrQ2FsbCA9IHtcclxuICAgICAgICAgICAgc2VydmljZTogJ0R5bmFtb0RCJyxcclxuICAgICAgICAgICAgYWN0aW9uOiAncHV0SXRlbScsXHJcbiAgICAgICAgICAgIHBhcmFtZXRlcnM6IHtcclxuICAgICAgICAgICAgICAgIFRhYmxlTmFtZTogZW50aXR5R3JhcGhUYWJsZS50YWJsZU5hbWUsXHJcbiAgICAgICAgICAgICAgICBJdGVtOiBtYXJzaGFsbChzeXN0ZW1TZXR0aW5ncyksXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHBoeXNpY2FsUmVzb3VyY2VJZDogY3IuUGh5c2ljYWxSZXNvdXJjZUlkLm9mKCdPcHRpcm9xU3lzdGVtU2V0dGluZ3NDb25maWctdjEnKSxcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IHNldHRpbmdzQ3VzdG9tUmVzb3VyY2UgPSBuZXcgY3IuQXdzQ3VzdG9tUmVzb3VyY2UodGhpcywgJ1N5c3RlbVNldHRpbmdzQ3VzdG9tUmVzb3VyY2UnLCB7XHJcbiAgICAgICAgICAgIG9uQ3JlYXRlOiBzZXR0aW5nc1Nka0NhbGwsXHJcbiAgICAgICAgICAgIG9uVXBkYXRlOiBzZXR0aW5nc1Nka0NhbGwsXHJcbiAgICAgICAgICAgIGxvZ1JldGVudGlvbjogUmV0ZW50aW9uRGF5cy5PTkVfV0VFSyxcclxuICAgICAgICAgICAgcG9saWN5OiBjci5Bd3NDdXN0b21SZXNvdXJjZVBvbGljeS5mcm9tU2RrQ2FsbHMoeyByZXNvdXJjZXM6IFtlbnRpdHlHcmFwaFRhYmxlLnRhYmxlQXJuXSB9KSxcclxuICAgICAgICB9KTtcclxuICAgICAgICBlbnRpdHlHcmFwaFRhYmxlLmdyYW50V3JpdGVEYXRhKHNldHRpbmdzQ3VzdG9tUmVzb3VyY2UpO1xyXG5cclxuICAgICAgICAvLyAtLS0gQ29nbml0byBVc2VyIFBvb2wgZm9yIFBvcnRhbCAtLS1cclxuICAgICAgICBjb25zdCB1c2VyUG9vbCA9IG5ldyBVc2VyUG9vbCh0aGlzLCAnT3B0aXJvcVVzZXJQb29sJywge1xyXG4gICAgICAgICAgICB1c2VyUG9vbE5hbWU6IGBPcHRpcm9xUG9ydGFsVXNlcnMtJHtzdGFnZU5hbWV9YCxcclxuICAgICAgICAgICAgc2VsZlNpZ25VcEVuYWJsZWQ6IHRydWUsXHJcbiAgICAgICAgICAgIHNpZ25JbkFsaWFzZXM6IHsgZW1haWw6IHRydWUgfSxcclxuICAgICAgICAgICAgcmVtb3ZhbFBvbGljeSxcclxuICAgICAgICB9KTtcclxuICAgICAgICBjb25zdCB1c2VyUG9vbENsaWVudCA9IG5ldyBVc2VyUG9vbENsaWVudCh0aGlzLCAnT3B0aXJvcVVzZXJQb29sQ2xpZW50JywgeyB1c2VyUG9vbCB9KTtcclxuXHJcbiAgICAgICAgLy8gLS0tIEZYIFJhdGUgRmV0Y2hlciBTZXJ2aWNlIC0tLVxyXG4gICAgICAgIGNvbnN0IGZ4QXBpS2V5U2VjcmV0ID0gc2VjcmV0c21hbmFnZXIuU2VjcmV0LmZyb21TZWNyZXROYW1lVjIodGhpcywgJ0Z4QXBpS2V5U2VjcmV0JywgYE9wdGlyb3FGeEFwaUtleS0ke3N0YWdlTmFtZX1gKTtcclxuICAgICAgICBjb25zdCBjb21tb2RpdHlBcGlLZXlTZWNyZXQgPSBzZWNyZXRzbWFuYWdlci5TZWNyZXQuZnJvbVNlY3JldE5hbWVWMih0aGlzLCAnQ29tbW9kaXR5QXBpS2V5U2VjcmV0JywgYE9wdGlyb3FDb21tb2RpdHlBcGlLZXktJHtzdGFnZU5hbWV9YCk7XHJcblxyXG4gICAgICAgIGNvbnN0IGZ4UmF0ZUZldGNoZXJMYW1iZGEgPSBuZXcgTm9kZWpzRnVuY3Rpb24odGhpcywgJ0Z4UmF0ZUZldGNoZXJMYW1iZGEnLCB7XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uTmFtZTogYG9wdGlyb3EtZnhyYXRlZmV0Y2hlci0ke3N0YWdlTmFtZS50b0xvd2VyQ2FzZSgpfWAsXHJcbiAgICAgICAgICAgIHJ1bnRpbWU6IGxhbWJkYS5SdW50aW1lLk5PREVKU18yMF9YLFxyXG4gICAgICAgICAgICBoYW5kbGVyOiAnaGFuZGxlcicsXHJcbiAgICAgICAgICAgIGVudHJ5OiBwYXRoLmpvaW4oX19kaXJuYW1lLCBgLi4vc3JjL29wdGlyb3EtbGFtYmRhcy9zZXJ2aWNlcy9meC1yYXRlLWZldGNoZXIuaGFuZGxlci50c2ApLFxyXG4gICAgICAgICAgICB0aW1lb3V0OiBjZGsuRHVyYXRpb24ubWludXRlcygxKSxcclxuICAgICAgICAgICAgbWVtb3J5U2l6ZTogMjU2LFxyXG4gICAgICAgICAgICBlbnZpcm9ubWVudDoge1xyXG4gICAgICAgICAgICAgICAgRlhfUkFURVNfVEFCTEU6IGZ4UmF0ZXNUYWJsZS50YWJsZU5hbWUsXHJcbiAgICAgICAgICAgICAgICBGWF9BUElfS0VZX1NFQ1JFVF9BUk46IGZ4QXBpS2V5U2VjcmV0LnNlY3JldEFybixcclxuICAgICAgICAgICAgICAgIEZYX0FQSV9VUkw6ICdodHRwczovL3Y2LmV4Y2hhbmdlcmF0ZS1hcGkuY29tL3Y2JyxcclxuICAgICAgICAgICAgICAgIEJBU0VfQ1VSUkVOQ1k6IHN5c3RlbVNldHRpbmdzLmJhc2VDdXJyZW5jeSxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgYnVuZGxpbmc6IHsgZXh0ZXJuYWxNb2R1bGVzOiBbJ0Bhd3Mtc2RrLyonXSB9LFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBmeFJhdGVzVGFibGUuZ3JhbnRXcml0ZURhdGEoZnhSYXRlRmV0Y2hlckxhbWJkYSk7XHJcbiAgICAgICAgZnhBcGlLZXlTZWNyZXQuZ3JhbnRSZWFkKGZ4UmF0ZUZldGNoZXJMYW1iZGEpO1xyXG5cclxuICAgICAgICBuZXcgZXZlbnRzLlJ1bGUodGhpcywgJ0Z4UmF0ZUZldGNoZXJTY2hlZHVsZScsIHtcclxuICAgICAgICAgICAgcnVsZU5hbWU6IGBPcHRpcm9xRnhSYXRlRmV0Y2hlclNjaGVkdWxlLSR7c3RhZ2VOYW1lfWAsXHJcbiAgICAgICAgICAgIHNjaGVkdWxlOiBldmVudHMuU2NoZWR1bGUucmF0ZShjZGsuRHVyYXRpb24uZGF5cygxKSksXHJcbiAgICAgICAgICAgIHRhcmdldHM6IFtuZXcgdGFyZ2V0cy5MYW1iZGFGdW5jdGlvbihmeFJhdGVGZXRjaGVyTGFtYmRhKV0sXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gLS0tIENlbnRyYWwgSUFNIFJvbGUgZm9yIE9wdGlyb3EgTGFtYmRhcyAtLS1cclxuICAgICAgICBjb25zdCBvcHRpcm9xTGFtYmRhUm9sZSA9IG5ldyBpYW0uUm9sZSh0aGlzLCAnT3B0aXJvcUxhbWJkYVJvbGUnLCB7XHJcbiAgICAgICAgICAgIGFzc3VtZWRCeTogbmV3IGlhbS5TZXJ2aWNlUHJpbmNpcGFsKCdsYW1iZGEuYW1hem9uYXdzLmNvbScpLFxyXG4gICAgICAgICAgICBtYW5hZ2VkUG9saWNpZXM6IFtpYW0uTWFuYWdlZFBvbGljeS5mcm9tQXdzTWFuYWdlZFBvbGljeU5hbWUoJ3NlcnZpY2Utcm9sZS9BV1NMYW1iZGFCYXNpY0V4ZWN1dGlvblJvbGUnKV0sXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgZW50aXR5R3JhcGhUYWJsZS5ncmFudFJlYWRXcml0ZURhdGEob3B0aXJvcUxhbWJkYVJvbGUpO1xyXG4gICAgICAgIGZ4UmF0ZXNUYWJsZS5ncmFudFJlYWREYXRhKG9wdGlyb3FMYW1iZGFSb2xlKTtcclxuICAgICAgICBjb21tb2RpdHlQcmljZXNUYWJsZS5ncmFudFJlYWREYXRhKG9wdGlyb3FMYW1iZGFSb2xlKTtcclxuICAgICAgICBhcnRlZmFjdHNCdWNrZXQuZ3JhbnRSZWFkV3JpdGUob3B0aXJvcUxhbWJkYVJvbGUpO1xyXG4gICAgICAgIGFydGVmYWN0c0J1Y2tldC5ncmFudFB1dChvcHRpcm9xTGFtYmRhUm9sZSwgJ2JvbS11cGxvYWRzLyonKTtcclxuICAgICAgICBhcnRlZmFjdHNCdWNrZXQuZ3JhbnRQdXQob3B0aXJvcUxhbWJkYVJvbGUsICdyZnEtdXBsb2Fkcy8qJyk7XHJcbiAgICAgICAgYWxsbWFGbG93U3RhcnRRdWV1ZS5ncmFudFNlbmRNZXNzYWdlcyhvcHRpcm9xTGFtYmRhUm9sZSk7XHJcbiAgICAgICAgb3B0aXJvcUxhbWJkYVJvbGUuYWRkVG9Qb2xpY3kobmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoeyBhY3Rpb25zOiBbJ3NlY3JldHNtYW5hZ2VyOkdldFNlY3JldFZhbHVlJ10sIHJlc291cmNlczogWycqJ10gfSkpO1xyXG4gICAgICAgIG9wdGlyb3FMYW1iZGFSb2xlLmFkZFRvUG9saWN5KG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHsgYWN0aW9uczogWyd0ZXh0cmFjdDoqJ10sIHJlc291cmNlczogWycqJ10gfSkpO1xyXG5cclxuICAgICAgICBjb25zdCBhbGxtYUluY29taW5nRW1haWxzQnVja2V0TmFtZSA9IGBhbGxtYS1pbmNvbWluZy1lbWFpbHMtJHt0aGlzLmFjY291bnR9LSR7c3RhZ2VOYW1lLnRvTG93ZXJDYXNlKCl9YDtcclxuICAgICAgICBjb25zdCBhbGxtYUV4ZWN1dGlvblRyYWNlc0J1Y2tldE5hbWUgPSBgYWxsbWEtZXhlY3V0aW9uLXRyYWNlcy0ke3RoaXMuYWNjb3VudH0tJHtzdGFnZU5hbWUudG9Mb3dlckNhc2UoKX1gO1xyXG4gICAgICAgIG9wdGlyb3FMYW1iZGFSb2xlLmFkZFRvUG9saWN5KG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcclxuICAgICAgICAgICAgc2lkOiAnQWxsb3dSZWFkRnJvbUFsbG1hQ29yZUJ1Y2tldHMnLFxyXG4gICAgICAgICAgICBlZmZlY3Q6IGlhbS5FZmZlY3QuQUxMT1csXHJcbiAgICAgICAgICAgIGFjdGlvbnM6IFsnczM6R2V0T2JqZWN0J10sXHJcbiAgICAgICAgICAgIHJlc291cmNlczogW1xyXG4gICAgICAgICAgICAgICAgYGFybjphd3M6czM6Ojoke2FsbG1hSW5jb21pbmdFbWFpbHNCdWNrZXROYW1lfS8qYCxcclxuICAgICAgICAgICAgICAgIGBhcm46YXdzOnMzOjo6JHthbGxtYUV4ZWN1dGlvblRyYWNlc0J1Y2tldE5hbWV9LypgLFxyXG4gICAgICAgICAgICBdLFxyXG4gICAgICAgIH0pKTtcclxuXHJcbiAgICAgICAgLy8gLS0tIExhbWJkYSBMYXllciAmIEZhY3RvcnkgRnVuY3Rpb24gLS0tXHJcbiAgICAgICAgY29uc3Qgb3B0aXJvcVR5cGVzTGF5ZXIgPSBuZXcgbGFtYmRhLkxheWVyVmVyc2lvbih0aGlzLCAnT3B0aXJvcVR5cGVzTGF5ZXInLCB7XHJcbiAgICAgICAgICAgIGNvZGU6IGxhbWJkYS5Db2RlLmZyb21Bc3NldChwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4vLi4vLi4vcGFja2FnZXMvb3B0aXJvcS10eXBlcycpKSxcclxuICAgICAgICAgICAgY29tcGF0aWJsZVJ1bnRpbWVzOiBbbGFtYmRhLlJ1bnRpbWUuTk9ERUpTXzIwX1hdLFxyXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogJ0xheWVyIGNvbnRhaW5pbmcgQG9wdGlyb3EvdHlwZXMgZm9yIGFsbCBPcHRpcm9xIExhbWJkYXMnLFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBjb25zdCBjcmVhdGVMYW1iZGEgPSAoXHJcbiAgICAgICAgICAgIG5hbWU6IHN0cmluZyxcclxuICAgICAgICAgICAgZW50cnk6IHN0cmluZyxcclxuICAgICAgICAgICAgdGltZW91dDogY2RrLkR1cmF0aW9uID0gY2RrLkR1cmF0aW9uLnNlY29uZHMoMzApLFxyXG4gICAgICAgICAgICBlbnZpcm9ubWVudDogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfSA9IHt9XHJcbiAgICAgICAgKTogTm9kZWpzRnVuY3Rpb24gPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IE5vZGVqc0Z1bmN0aW9uKHRoaXMsIGAke25hbWV9RnVuY3Rpb25gLCB7XHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbk5hbWU6IGBvcHRpcm9xLSR7bmFtZS50b0xvd2VyQ2FzZSgpfS0ke3N0YWdlTmFtZS50b0xvd2VyQ2FzZSgpfWAsXHJcbiAgICAgICAgICAgICAgICBydW50aW1lOiBsYW1iZGEuUnVudGltZS5OT0RFSlNfMjBfWCxcclxuICAgICAgICAgICAgICAgIGhhbmRsZXI6ICdoYW5kbGVyJyxcclxuICAgICAgICAgICAgICAgIGVudHJ5OiBwYXRoLmpvaW4oX19kaXJuYW1lLCBgLi4vc3JjL29wdGlyb3EtbGFtYmRhcy8ke2VudHJ5fWApLFxyXG4gICAgICAgICAgICAgICAgcm9sZTogb3B0aXJvcUxhbWJkYVJvbGUsXHJcbiAgICAgICAgICAgICAgICB0aW1lb3V0LFxyXG4gICAgICAgICAgICAgICAgbWVtb3J5U2l6ZTogNTEyLFxyXG4gICAgICAgICAgICAgICAgZW52aXJvbm1lbnQ6IHtcclxuICAgICAgICAgICAgICAgICAgICBFTlRJVFlfR1JBUEhfVEFCTEU6IGVudGl0eUdyYXBoVGFibGUudGFibGVOYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgIEFSVEVGQUNUU19CVUNLRVQ6IGFydGVmYWN0c0J1Y2tldC5idWNrZXROYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgIEFMTE9XRURfT1JJR0lOUzogcHJvcHMuc3RhZ2VDb25maWcub3B0aXJvcUFwaS5hbGxvd2VkT3JpZ2lucy5qb2luKCcsJyksXHJcbiAgICAgICAgICAgICAgICAgICAgLi4uZW52aXJvbm1lbnQsXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgbGF5ZXJzOiBbb3B0aXJvcVR5cGVzTGF5ZXJdLFxyXG4gICAgICAgICAgICAgICAgYnVuZGxpbmc6IHtcclxuICAgICAgICAgICAgICAgICAgICBleHRlcm5hbE1vZHVsZXM6IFsnQG9wdGlyb3EvdHlwZXMnXSxcclxuICAgICAgICAgICAgICAgICAgICBtaW5pZnk6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgc291cmNlTWFwOiB0cnVlXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyAtLS0gTGFtYmRhIERlZmluaXRpb25zIC0tLVxyXG4gICAgICAgIGNvbnN0IHBhcnNlQW5kQ29ycmVsYXRlRW1haWxMYW1iZGEgPSBjcmVhdGVMYW1iZGEoJ1BhcnNlQW5kQ29ycmVsYXRlRW1haWwnLCAnYWxsbWEtc3RlcHMvY29tbXVuaWNhdGlvbi9wYXJzZS1hbmQtY29ycmVsYXRlLWVtYWlsLnN0ZXAudHMnKTtcclxuICAgICAgICBjb25zdCBwYXJzZUVtYWlsQW5kTG9hZENvbnRleHRMYW1iZGEgPSBjcmVhdGVMYW1iZGEoJ1BhcnNlRW1haWxBbmRMb2FkQ29udGV4dCcsICdhbGxtYS1zdGVwcy9wcm9jZXNzLXN1cHBsaWVyLXF1b3RlL3BhcnNlLWVtYWlsLWFuZC1sb2FkLWNvbnRleHQuc3RlcC50cycpO1xyXG4gICAgICAgIGNvbnN0IHNhbml0aXplUXVvdGVEb2N1bWVudFN0ZXBMYW1iZGEgPSBjcmVhdGVMYW1iZGEoJ1Nhbml0aXplUXVvdGVEb2N1bWVudFN0ZXAnLCAnYWxsbWEtc3RlcHMvcHJvY2Vzcy1zdXBwbGllci1xdW90ZS9zYW5pdGl6ZS1xdW90ZS1kb2N1bWVudC5zdGVwLnRzJyk7XHJcbiAgICAgICAgY29uc3Qgbm9ybWFsaXplUXVvdGVEYXRhU3RlcExhbWJkYSA9IGNyZWF0ZUxhbWJkYSgnTm9ybWFsaXplUXVvdGVEYXRhU3RlcCcsICdhbGxtYS1zdGVwcy9wcm9jZXNzLXN1cHBsaWVyLXF1b3RlL25vcm1hbGl6ZS1xdW90ZS1kYXRhLnN0ZXAudHMnLCBjZGsuRHVyYXRpb24uc2Vjb25kcyg0NSksIHtcclxuICAgICAgICAgICAgRlhfUkFURVNfVEFCTEU6IGZ4UmF0ZXNUYWJsZS50YWJsZU5hbWUsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgY29uc3QgZ2VuZXJhdGVDb21wYXJpc29uQm9hcmRTdGVwTGFtYmRhID0gY3JlYXRlTGFtYmRhKCdHZW5lcmF0ZUNvbXBhcmlzb25Cb2FyZFN0ZXAnLCAnYWxsbWEtc3RlcHMvZ2VuZXJhdGUtY29tcGFyaXNvbi1ib2FyZC5zdGVwLnRzJywgY2RrLkR1cmF0aW9uLm1pbnV0ZXMoMSkpO1xyXG4gICAgICAgIGNvbnN0IHJ1bGVCYXNlZEFub21hbHlDaGVja0xhbWJkYSA9IGNyZWF0ZUxhbWJkYSgnUnVsZUJhc2VkQW5vbWFseUNoZWNrJywgJ2FsbG1hLXN0ZXBzL3Byb2Nlc3Mtc3VwcGxpZXItcXVvdGUvcnVsZS1iYXNlZC1hbm9tYWx5LWNoZWNrLnN0ZXAudHMnKTtcclxuICAgICAgICBjb25zdCByaXNrU2NvcmVDYWxjdWxhdGlvbkxhbWJkYSA9IGNyZWF0ZUxhbWJkYSgnUmlza1Njb3JlQ2FsY3VsYXRpb24nLCAnYWxsbWEtc3RlcHMvcHJvY2Vzcy1zdXBwbGllci1xdW90ZS9yaXNrLXNjb3JlLWNhbGN1bGF0aW9uLnN0ZXAudHMnKTtcclxuICAgICAgICBjb25zdCBjb21wb3NlQmF0Y2hXcml0ZUxhbWJkYSA9IGNyZWF0ZUxhbWJkYSgnQ29tcG9zZUJhdGNoV3JpdGUnLCAnYWxsbWEtc3RlcHMvcHJvY2Vzcy1zdXBwbGllci1xdW90ZS9jb21wb3NlLWJhdGNoLXdyaXRlLnN0ZXAudHMnKTtcclxuXHJcbiAgICAgICAgY29uc3QgZXh0cmFjdFdvcmtib29rRGF0YUxhbWJkYSA9IGNyZWF0ZUxhbWJkYSgnRXh0cmFjdFdvcmtib29rRGF0YScsICdhbGxtYS1zdGVwcy9wcm9jZXNzLWJvbS11cGxvYWQvZXh0cmFjdC13b3JrYm9vay1kYXRhLnN0ZXAudHMnLCBjZGsuRHVyYXRpb24ubWludXRlcygzKSk7XHJcbiAgICAgICAgY29uc3QgZXh0cmFjdERhdGFGcm9tQm9tTGFtYmRhID0gY3JlYXRlTGFtYmRhKCdFeHRyYWN0RGF0YUZyb21Cb20nLCAnYWxsbWEtc3RlcHMvcHJvY2Vzcy1ib20tdXBsb2FkL2V4dHJhY3QtZGF0YS1mcm9tLWJvbS5zdGVwLnRzJyk7XHJcbiAgICAgICAgY29uc3QgbWFwQW5kVmFsaWRhdGVCb21EYXRhTGFtYmRhID0gY3JlYXRlTGFtYmRhKCdNYXBBbmRWYWxpZGF0ZUJvbURhdGEnLCAnYWxsbWEtc3RlcHMvcHJvY2Vzcy1ib20tdXBsb2FkL21hcC1hbmQtdmFsaWRhdGUtYm9tLWRhdGEuc3RlcC50cycsIGNkay5EdXJhdGlvbi5taW51dGVzKDEpLCB7XHJcbiAgICAgICAgICAgIEZYX1JBVEVTX1RBQkxFOiBmeFJhdGVzVGFibGUudGFibGVOYW1lLFxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGNvbnN0IHVwZGF0ZVByb2plY3RXaXRoQm9tRGF0YUxhbWJkYSA9IGNyZWF0ZUxhbWJkYSgnVXBkYXRlUHJvamVjdFdpdGhCb21EYXRhJywgJ2FsbG1hLXN0ZXBzL3Byb2Nlc3MtYm9tLXVwbG9hZC91cGRhdGUtcHJvamVjdC13aXRoLWJvbS1kYXRhLnN0ZXAudHMnKTtcclxuICAgICAgICBjb25zdCBwZXJzaXN0Q2xhc3NpZmllZFBhcnRMYW1iZGEgPSBjcmVhdGVMYW1iZGEoJ1BlcnNpc3RDbGFzc2lmaWVkUGFydCcsICdhbGxtYS1zdGVwcy9wcm9jZXNzLWJvbS11cGxvYWQvcGVyc2lzdC1jbGFzc2lmaWVkLXBhcnQuc3RlcC50cycsIGNkay5EdXJhdGlvbi5zZWNvbmRzKDQ1KSk7XHJcblxyXG4gICAgICAgIC8vIFN1cHBsaWVyIEltcG9ydCBMYW1iZGFzXHJcbiAgICAgICAgY29uc3QgbWFwQW5kVmFsaWRhdGVTdXBwbGllckRhdGFMYW1iZGEgPSBjcmVhdGVMYW1iZGEoJ01hcEFuZFZhbGlkYXRlU3VwcGxpZXJEYXRhJywgJ2FsbG1hLXN0ZXBzL3N1cHBsaWVyLWltcG9ydC9tYXAtYW5kLXZhbGlkYXRlLXN1cHBsaWVyLWRhdGEuc3RlcC50cycsIGNkay5EdXJhdGlvbi5taW51dGVzKDEpKTtcclxuICAgICAgICBjb25zdCByZWNvbmNpbGVTdXBwbGllckNvbW1vZGl0aWVzTGFtYmRhID0gY3JlYXRlTGFtYmRhKCdSZWNvbmNpbGVTdXBwbGllckNvbW1vZGl0aWVzJywgJ2FsbG1hLXN0ZXBzL3N1cHBsaWVyLWltcG9ydC9yZWNvbmNpbGUtc3VwcGxpZXItY29tbW9kaXRpZXMuc3RlcC50cycpO1xyXG4gICAgICAgIGNvbnN0IHBlcnNpc3RTdXBwbGllckxhbWJkYSA9IGNyZWF0ZUxhbWJkYSgnUGVyc2lzdFN1cHBsaWVyJywgJ2FsbG1hLXN0ZXBzL3N1cHBsaWVyLWltcG9ydC9wZXJzaXN0LXN1cHBsaWVyLnN0ZXAudHMnLCBjZGsuRHVyYXRpb24uc2Vjb25kcyg0NSkpO1xyXG5cclxuICAgICAgICAvLyBSRlEgVXBsb2FkIEZsb3cgTGFtYmRhc1xyXG4gICAgICAgIGNvbnN0IHNhbml0aXplUmZxRG9jdW1lbnRFeGNlbExhbWJkYSA9IGNyZWF0ZUxhbWJkYSgnU2FuaXRpemVSZnFEb2N1bWVudEV4Y2VsJywgJ2FsbG1hLXN0ZXBzL3JmcS11cGxvYWQvc2FuaXRpemUtcmZxLWRvY3VtZW50LWV4Y2VsLnN0ZXAudHMnLCBjZGsuRHVyYXRpb24ubWludXRlcygyKSk7XHJcbiAgICAgICAgY29uc3Qgc2FuaXRpemVSZnFEb2N1bWVudE9jckxhbWJkYSA9IGNyZWF0ZUxhbWJkYSgnU2FuaXRpemVSZnFEb2N1bWVudE9jcicsICdhbGxtYS1zdGVwcy9yZnEtdXBsb2FkL3Nhbml0aXplLXJmcS1kb2N1bWVudC1vY3Iuc3RlcC50cycsIGNkay5EdXJhdGlvbi5taW51dGVzKDIpKTtcclxuICAgICAgICBjb25zdCBzYW5pdGl6ZVJmcURvY3VtZW50UHB0TGFtYmRhID0gY3JlYXRlTGFtYmRhKCdTYW5pdGl6ZVJmcURvY3VtZW50UHB0JywgJ2FsbG1hLXN0ZXBzL3JmcS11cGxvYWQvc2FuaXRpemUtcmZxLWRvY3VtZW50LXBwdC5zdGVwLnRzJyk7XHJcbiAgICAgICAgY29uc3QgdmFsaWRhdGVBbmRTYXZlUmZxRHJhZnRMYW1iZGEgPSBjcmVhdGVMYW1iZGEoJ1ZhbGlkYXRlQW5kU2F2ZVJmcURyYWZ0JywgJ2FsbG1hLXN0ZXBzL3JmcS11cGxvYWQvdmFsaWRhdGUtYW5kLXNhdmUtcmZxLWRyYWZ0LnN0ZXAudHMnLCBjZGsuRHVyYXRpb24ubWludXRlcygxKSk7XHJcblxyXG4gICAgICAgIGNvbnN0IGdlbmVyYXRlQXR0YWNobWVudExpbmtzTGFtYmRhID0gY3JlYXRlTGFtYmRhKCdHZW5lcmF0ZUF0dGFjaG1lbnRMaW5rcycsICdhbGxtYS1zdGVwcy9jb21tdW5pY2F0aW9uL2dlbmVyYXRlLWF0dGFjaG1lbnQtbGlua3Muc3RlcC50cycpO1xyXG5cclxuXHJcbiAgICAgICAgY29uc3QgZ2V0Vmlld0FwaUhhbmRsZXIgPSBjcmVhdGVMYW1iZGEoJ0dldFZpZXdBcGlIYW5kbGVyJywgJ2FwaS9nZXQtdmlldy5oYW5kbGVyLnRzJywgY2RrLkR1cmF0aW9uLnNlY29uZHMoMzApLCB7XHJcbiAgICAgICAgICAgIEZYX1JBVEVTX1RBQkxFOiBmeFJhdGVzVGFibGUudGFibGVOYW1lLFxyXG4gICAgICAgICAgICBDT01NT0RJVFlfUFJJQ0VTX1RBQkxFOiBjb21tb2RpdHlQcmljZXNUYWJsZS50YWJsZU5hbWUsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgY29uc3QgcG9zdENvbW1hbmRBcGlIYW5kbGVyID0gY3JlYXRlTGFtYmRhKCdQb3N0Q29tbWFuZEFwaUhhbmRsZXInLCAnYXBpL3Bvc3QtY29tbWFuZC5oYW5kbGVyLnRzJywgY2RrLkR1cmF0aW9uLnNlY29uZHMoMzApLCB7XHJcbiAgICAgICAgICAgIEFMTE1BX1NUQVJUX1FVRVVFX1VSTDogYWxsbWFGbG93U3RhcnRRdWV1ZVVybCxcclxuICAgICAgICAgICAgRlhfUkFURVNfVEFCTEU6IGZ4UmF0ZXNUYWJsZS50YWJsZU5hbWUsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgY29uc3QgZ2V0VXBsb2FkVXJsQXBpSGFuZGxlciA9IGNyZWF0ZUxhbWJkYSgnR2V0VXBsb2FkVXJsQXBpSGFuZGxlcicsICdhcGkvZ2V0LXVwbG9hZC11cmwuaGFuZGxlci50cycpO1xyXG4gICAgICAgIGNvbnN0IHVwZGF0ZVByb2plY3RBZ2dyZWdhdGVzU3RyZWFtTGFtYmRhID0gY3JlYXRlTGFtYmRhKCdVcGRhdGVQcm9qZWN0QWdncmVnYXRlc1N0cmVhbScsICdzdHJlYW1zL3VwZGF0ZS1wcm9qZWN0LWFnZ3JlZ2F0ZXMuc3RyZWFtLnRzJyk7XHJcbiAgICAgICAgdXBkYXRlUHJvamVjdEFnZ3JlZ2F0ZXNTdHJlYW1MYW1iZGEuYWRkRXZlbnRTb3VyY2UobmV3IGNkay5hd3NfbGFtYmRhX2V2ZW50X3NvdXJjZXMuRHluYW1vRXZlbnRTb3VyY2UoZW50aXR5R3JhcGhUYWJsZSwge1xyXG4gICAgICAgICAgICBzdGFydGluZ1Bvc2l0aW9uOiBsYW1iZGEuU3RhcnRpbmdQb3NpdGlvbi5MQVRFU1QsXHJcbiAgICAgICAgfSkpO1xyXG5cclxuICAgICAgICAvLyAtLS0gQVBJIEdhdGV3YXkgU2V0dXAgLS0tXHJcbiAgICAgICAgY29uc3QgYXV0aG9yaXplciA9IG5ldyBIdHRwVXNlclBvb2xBdXRob3JpemVyKCdPcHRpcm9xQ29nbml0b0F1dGhvcml6ZXInLCB1c2VyUG9vbCwgeyB1c2VyUG9vbENsaWVudHM6IFt1c2VyUG9vbENsaWVudF0gfSk7XHJcbiAgICAgICAgY29uc3QgaHR0cEFwaSA9IG5ldyBhcGlndy5IdHRwQXBpKHRoaXMsICdPcHRpcm9xSHR0cEFwaScsIHsgYXBpTmFtZTogYE9wdGlyb3FBcGktJHtzdGFnZU5hbWV9YCwgZGVmYXVsdEF1dGhvcml6ZXI6IGF1dGhvcml6ZXIsIGNyZWF0ZURlZmF1bHRTdGFnZTogZmFsc2UgfSk7XHJcbiAgICAgICAgY29uc3QgYXBpU3RhZ2UgPSBuZXcgYXBpZ3cuSHR0cFN0YWdlKHRoaXMsICdPcHRpcm9xQXBpU3RhZ2UnLCB7IGh0dHBBcGksIHN0YWdlTmFtZTogc3RhZ2VOYW1lLCBhdXRvRGVwbG95OiB0cnVlIH0pO1xyXG4gICAgICAgIGNvbnN0IGNlcnRpZmljYXRlID0gYWNtLkNlcnRpZmljYXRlLmZyb21DZXJ0aWZpY2F0ZUFybih0aGlzLCAnT3B0aXJvcUFwaUNlcnQnLCBzdGFnZUNvbmZpZy5vcHRpcm9xQXBpLmNlcnRpZmljYXRlQXJuKTtcclxuICAgICAgICBjb25zdCBkb21haW5OYW1lID0gbmV3IGFwaWd3LkRvbWFpbk5hbWUodGhpcywgJ09wdGlyb3FBcGlDdXN0b21Eb21haW4nLCB7IGRvbWFpbk5hbWU6IHN0YWdlQ29uZmlnLm9wdGlyb3FBcGkuZG9tYWluTmFtZSwgY2VydGlmaWNhdGUgfSk7XHJcbiAgICAgICAgbmV3IGFwaWd3LkFwaU1hcHBpbmcodGhpcywgJ09wdGlyb3FBcGlNYXBwaW5nJywgeyBhcGk6IGh0dHBBcGksIGRvbWFpbk5hbWU6IGRvbWFpbk5hbWUsIHN0YWdlOiBhcGlTdGFnZSB9KTtcclxuXHJcblxyXG4gICAgICAgIGlmIChzdGFnZUNvbmZpZy5vcHRpcm9xQXBpLmhvc3RlZFpvbmVJZCAmJiBzdGFnZUNvbmZpZy5vcHRpcm9xQXBpLmhvc3RlZFpvbmVOYW1lKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHpvbmUgPSByb3V0ZTUzLkhvc3RlZFpvbmUuZnJvbUhvc3RlZFpvbmVBdHRyaWJ1dGVzKHRoaXMsICdPcHRpcm9xQXBpSG9zdGVkWm9uZScsIHtcclxuICAgICAgICAgICAgICAgIGhvc3RlZFpvbmVJZDogc3RhZ2VDb25maWcub3B0aXJvcUFwaS5ob3N0ZWRab25lSWQsXHJcbiAgICAgICAgICAgICAgICB6b25lTmFtZTogc3RhZ2VDb25maWcub3B0aXJvcUFwaS5ob3N0ZWRab25lTmFtZSxcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIG5ldyByb3V0ZTUzLkFSZWNvcmQodGhpcywgJ09wdGlyb3FBcGlEbnNSZWNvcmQnLCB7IHpvbmU6IHpvbmUsIHJlY29yZE5hbWU6IHN0YWdlQ29uZmlnLm9wdGlyb3FBcGkuZG9tYWluTmFtZSwgdGFyZ2V0OiByb3V0ZTUzLlJlY29yZFRhcmdldC5mcm9tQWxpYXMobmV3IHJvdXRlNTNUYXJnZXRzLkFwaUdhdGV3YXl2MkRvbWFpblByb3BlcnRpZXMoZG9tYWluTmFtZS5yZWdpb25hbERvbWFpbk5hbWUsIGRvbWFpbk5hbWUucmVnaW9uYWxIb3N0ZWRab25lSWQpKSB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IG9wdGlyb3FBcGlVcmwgPSBgaHR0cHM6Ly8ke2RvbWFpbk5hbWUubmFtZX1gO1xyXG4gICAgICAgIGh0dHBBcGkuYWRkUm91dGVzKHsgcGF0aDogJy92aWV3cy97dmlld05hbWV9JywgbWV0aG9kczogW2FwaWd3Lkh0dHBNZXRob2QuR0VUXSwgaW50ZWdyYXRpb246IG5ldyBIdHRwTGFtYmRhSW50ZWdyYXRpb24oJ0dldFZpZXdMaXN0SW50ZWdyYXRpb24nLCBnZXRWaWV3QXBpSGFuZGxlcikgfSk7XHJcbiAgICAgICAgaHR0cEFwaS5hZGRSb3V0ZXMoeyBwYXRoOiAnL3ZpZXdzL3t2aWV3TmFtZX0ve2lkfScsIG1ldGhvZHM6IFthcGlndy5IdHRwTWV0aG9kLkdFVF0sIGludGVncmF0aW9uOiBuZXcgSHR0cExhbWJkYUludGVncmF0aW9uKCdHZXRWaWV3SW50ZWdyYXRpb24nLCBnZXRWaWV3QXBpSGFuZGxlcikgfSk7XHJcbiAgICAgICAgaHR0cEFwaS5hZGRSb3V0ZXMoeyBwYXRoOiAnL2NvbW1hbmRzL3tlbnRpdHlUeXBlfScsIG1ldGhvZHM6IFthcGlndy5IdHRwTWV0aG9kLlBPU1RdLCBpbnRlZ3JhdGlvbjogbmV3IEh0dHBMYW1iZGFJbnRlZ3JhdGlvbignUG9zdENvbW1hbmRDcmVhdGlvbkludGVncmF0aW9uJywgcG9zdENvbW1hbmRBcGlIYW5kbGVyKSB9KTtcclxuICAgICAgICBodHRwQXBpLmFkZFJvdXRlcyh7IHBhdGg6ICcvY29tbWFuZHMve2VudGl0eVR5cGV9L3tpZH0nLCBtZXRob2RzOiBbYXBpZ3cuSHR0cE1ldGhvZC5QT1NUXSwgaW50ZWdyYXRpb246IG5ldyBIdHRwTGFtYmRhSW50ZWdyYXRpb24oJ1Bvc3RDb21tYW5kVXBkYXRlSW50ZWdyYXRpb24nLCBwb3N0Q29tbWFuZEFwaUhhbmRsZXIpIH0pO1xyXG4gICAgICAgIGh0dHBBcGkuYWRkUm91dGVzKHsgcGF0aDogJy9maWxlcy91cGxvYWQtdXJsJywgbWV0aG9kczogW2FwaWd3Lkh0dHBNZXRob2QuUE9TVF0sIGludGVncmF0aW9uOiBuZXcgSHR0cExhbWJkYUludGVncmF0aW9uKCdHZXRVcGxvYWRVcmxJbnRlZ3JhdGlvbicsIGdldFVwbG9hZFVybEFwaUhhbmRsZXIpLCBhdXRob3JpemVyOiBhdXRob3JpemVyIH0pO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIC0tLSBGcm9udGVuZCBQb3J0YWwgRGVwbG95bWVudCAtLS1cclxuICAgICAgICBjb25zdCB3ZWJBcHAgPSBuZXcgV2ViQXBwRGVwbG95bWVudCh0aGlzLCAnUG9ydGFsV2ViQXBwJywge1xyXG4gICAgICAgICAgICBkZXBsb3ltZW50SWQ6IGBPcHRpcm9xUG9ydGFsLSR7c3RhZ2VOYW1lfWAsXHJcbiAgICAgICAgICAgIGFzc2V0UGF0aDogcGF0aC5qb2luKF9fZGlybmFtZSwgJy4uL3NyYy9wb3J0YWwtdWkvZGlzdCcpLFxyXG4gICAgICAgICAgICBydW50aW1lQ29uZmlnOiB7XHJcbiAgICAgICAgICAgICAgICBWSVRFX0FXU19SRUdJT046IHRoaXMucmVnaW9uLFxyXG4gICAgICAgICAgICAgICAgVklURV9DT0dOSVRPX1VTRVJfUE9PTF9JRDogdXNlclBvb2wudXNlclBvb2xJZCxcclxuICAgICAgICAgICAgICAgIFZJVEVfQ09HTklUT19VU0VSX1BPT0xfQ0xJRU5UX0lEOiB1c2VyUG9vbENsaWVudC51c2VyUG9vbENsaWVudElkLFxyXG4gICAgICAgICAgICAgICAgVklURV9BUElfQkFTRV9VUkw6IG9wdGlyb3FBcGlVcmwsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGRvbWFpbk5hbWU6IHN0YWdlQ29uZmlnLm9wdGlyb3FQb3J0YWwuZG9tYWluTmFtZSxcclxuICAgICAgICAgICAgY2VydGlmaWNhdGVBcm46IHN0YWdlQ29uZmlnLm9wdGlyb3FQb3J0YWwuY2VydGlmaWNhdGVBcm5cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gLS0tIENPUlMgQ29uZmlndXJhdGlvbiAtLS1cclxuICAgICAgICBjb25zdCBwb3J0YWxDbG91ZEZyb250VXJsID0gYGh0dHBzOi8vJHt3ZWJBcHAuZGlzdHJpYnV0aW9uLmRpc3RyaWJ1dGlvbkRvbWFpbk5hbWV9YDtcclxuICAgICAgICBjb25zdCBmaW5hbE9yaWdpbnMgPSBBcnJheS5mcm9tKG5ldyBTZXQoWy4uLnN0YWdlQ29uZmlnLm9wdGlyb3FBcGkuYWxsb3dlZE9yaWdpbnMsIHBvcnRhbENsb3VkRnJvbnRVcmxdKSk7XHJcbiAgICAgICAgY29uc3QgY2ZuQXBpID0gaHR0cEFwaS5ub2RlLmRlZmF1bHRDaGlsZCBhcyBhcGlndy5DZm5BcGk7XHJcbiAgICAgICAgY2ZuQXBpLmFkZFByb3BlcnR5T3ZlcnJpZGUoJ0NvcnNDb25maWd1cmF0aW9uJywge1xyXG4gICAgICAgICAgICBBbGxvd09yaWdpbnM6IGZpbmFsT3JpZ2lucyxcclxuICAgICAgICAgICAgQWxsb3dNZXRob2RzOiBbJ0dFVCcsICdQT1NUJywgJ1BVVCcsICdERUxFVEUnLCAnT1BUSU9OUyddLFxyXG4gICAgICAgICAgICBBbGxvd0hlYWRlcnM6IFsnQ29udGVudC1UeXBlJywgJ1gtQW16LURhdGUnLCAnQXV0aG9yaXphdGlvbicsICdYLUFwaS1LZXknLCAnWC1BbXotU2VjdXJpdHktVG9rZW4nLCAnWC1BbXotVXNlci1BZ2VudCddLFxyXG4gICAgICAgICAgICBNYXhBZ2U6IDM2MDAsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgY29uc3QgYWxsb3dlZE9yaWdpbnNTdHJpbmcgPSBmaW5hbE9yaWdpbnMuam9pbignLCcpO1xyXG4gICAgICAgIFtnZXRWaWV3QXBpSGFuZGxlciwgcG9zdENvbW1hbmRBcGlIYW5kbGVyLCBnZXRVcGxvYWRVcmxBcGlIYW5kbGVyXS5mb3JFYWNoKGZuID0+IHtcclxuICAgICAgICAgICAgZm4uYWRkRW52aXJvbm1lbnQoJ0FMTE9XRURfT1JJR0lOUycsIGFsbG93ZWRPcmlnaW5zU3RyaW5nKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gLS0tIENyb3NzLVN0YWNrIFBlcm1pc3Npb25zIC0tLVxyXG4gICAgICAgIGNvbnN0IGFsbG1hT3JjaGVzdHJhdGlvblJvbGUgPSBpYW0uUm9sZS5mcm9tUm9sZUFybih0aGlzLCAnQWxsbWFPcmNoZXN0cmF0aW9uUm9sZScsIGFsbG1hT3JjaGVzdHJhdGlvblJvbGVBcm4pO1xyXG4gICAgICAgIGNvbnN0IG9wdGlyb3FDdXN0b21TdGVwTGFtYmRhcyA9IFtcclxuICAgICAgICAgICAgZ2VuZXJhdGVBdHRhY2htZW50TGlua3NMYW1iZGEsXHJcbiAgICAgICAgICAgIHBhcnNlQW5kQ29ycmVsYXRlRW1haWxMYW1iZGEsXHJcbiAgICAgICAgICAgIHBhcnNlRW1haWxBbmRMb2FkQ29udGV4dExhbWJkYSxcclxuICAgICAgICAgICAgc2FuaXRpemVRdW90ZURvY3VtZW50U3RlcExhbWJkYSwgbm9ybWFsaXplUXVvdGVEYXRhU3RlcExhbWJkYSwgZ2VuZXJhdGVDb21wYXJpc29uQm9hcmRTdGVwTGFtYmRhLFxyXG4gICAgICAgICAgICBleHRyYWN0V29ya2Jvb2tEYXRhTGFtYmRhLCBleHRyYWN0RGF0YUZyb21Cb21MYW1iZGEsIG1hcEFuZFZhbGlkYXRlQm9tRGF0YUxhbWJkYSxcclxuICAgICAgICAgICAgdXBkYXRlUHJvamVjdFdpdGhCb21EYXRhTGFtYmRhLCBwZXJzaXN0Q2xhc3NpZmllZFBhcnRMYW1iZGEsXHJcbiAgICAgICAgICAgIC8vIG5ldyBxdW90ZSBwcm9jZXNzaW5nIGxhbWJkYXNcclxuICAgICAgICAgICAgcnVsZUJhc2VkQW5vbWFseUNoZWNrTGFtYmRhLCByaXNrU2NvcmVDYWxjdWxhdGlvbkxhbWJkYSwgY29tcG9zZUJhdGNoV3JpdGVMYW1iZGEsXHJcbiAgICAgICAgICAgIC8vIHN1cHBsaWVyIGltcG9ydCBsYW1iZGFzXHJcbiAgICAgICAgICAgIG1hcEFuZFZhbGlkYXRlU3VwcGxpZXJEYXRhTGFtYmRhLCByZWNvbmNpbGVTdXBwbGllckNvbW1vZGl0aWVzTGFtYmRhLCBwZXJzaXN0U3VwcGxpZXJMYW1iZGEsXHJcbiAgICAgICAgICAgIC8vIFJGUSB1cGxvYWQgbGFtYmRhc1xyXG4gICAgICAgICAgICBzYW5pdGl6ZVJmcURvY3VtZW50RXhjZWxMYW1iZGEsIHNhbml0aXplUmZxRG9jdW1lbnRPY3JMYW1iZGEsXHJcbiAgICAgICAgICAgIHNhbml0aXplUmZxRG9jdW1lbnRQcHRMYW1iZGEsIHZhbGlkYXRlQW5kU2F2ZVJmcURyYWZ0TGFtYmRhLFxyXG4gICAgICAgIF07XHJcbiAgICAgICAgbmV3IGlhbS5Qb2xpY3kodGhpcywgJ0FsbG1hT3B0aXJvcUludm9rZVBvbGljeScsIHtcclxuICAgICAgICAgICAgcm9sZXM6IFthbGxtYU9yY2hlc3RyYXRpb25Sb2xlXSxcclxuICAgICAgICAgICAgc3RhdGVtZW50czogW1xyXG4gICAgICAgICAgICAgICAgbmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xyXG4gICAgICAgICAgICAgICAgICAgIHNpZDogJ0FsbG93QWxsbWFUb0ludm9rZU9wdGlyb3FMYW1iZGFzJyxcclxuICAgICAgICAgICAgICAgICAgICBlZmZlY3Q6IGlhbS5FZmZlY3QuQUxMT1csXHJcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uczogWydsYW1iZGE6SW52b2tlRnVuY3Rpb24nXSxcclxuICAgICAgICAgICAgICAgICAgICByZXNvdXJjZXM6IG9wdGlyb3FDdXN0b21TdGVwTGFtYmRhcy5tYXAoZm4gPT4gZm4uZnVuY3Rpb25Bcm4pLFxyXG4gICAgICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgIF0sXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIC0tLSBDREsgT3V0cHV0cyAtLS1cclxuICAgICAgICBuZXcgY2RrLkNmbk91dHB1dCh0aGlzLCAnT3B0aXJvcUVudGl0eUdyYXBoVGFibGVOYW1lJywgeyB2YWx1ZTogZW50aXR5R3JhcGhUYWJsZS50YWJsZU5hbWUgfSk7XHJcbiAgICAgICAgbmV3IGNkay5DZm5PdXRwdXQodGhpcywgJ09wdGlyb3FBcnRlZmFjdHNCdWNrZXROYW1lJywgeyB2YWx1ZTogYXJ0ZWZhY3RzQnVja2V0LmJ1Y2tldE5hbWUgfSk7XHJcbiAgICAgICAgbmV3IGNkay5DZm5PdXRwdXQodGhpcywgJ09wdGlyb3FBcGlHYXRld2F5VXJsJywgeyB2YWx1ZTogZG9tYWluTmFtZS5yZWdpb25hbERvbWFpbk5hbWUgfSk7XHJcbiAgICAgICAgbmV3IGNkay5DZm5PdXRwdXQodGhpcywgJ09wdGlyb3FQb3J0YWxVcmwnLCB7IHZhbHVlOiB3ZWJBcHAuZGlzdHJpYnV0aW9uLmRpc3RyaWJ1dGlvbkRvbWFpbk5hbWUgfSk7XHJcbiAgICAgICAgbmV3IGNkay5DZm5PdXRwdXQodGhpcywgJ09wdGlyb3FGeFJhdGVzVGFibGVOYW1lJywgeyB2YWx1ZTogZnhSYXRlc1RhYmxlLnRhYmxlTmFtZSB9KTtcclxuICAgICAgICBuZXcgY2RrLkNmbk91dHB1dCh0aGlzLCAnT3B0aXJvcUNvbW1vZGl0eVByaWNlc1RhYmxlTmFtZScsIHsgdmFsdWU6IGNvbW1vZGl0eVByaWNlc1RhYmxlLnRhYmxlTmFtZSB9KTtcclxuXHJcbiAgICAgICAgLy8gLS0tIENESyBOYWcgU3VwcHJlc3Npb25zIC0tLVxyXG4gICAgICAgIE5hZ1N1cHByZXNzaW9ucy5hZGRTdGFja1N1cHByZXNzaW9ucyh0aGlzLCBbeyBpZDogJ0F3c1NvbHV0aW9ucy1JQU00JywgcmVhc29uOiAnVXNpbmcgQVdTIG1hbmFnZWQgcG9saWNpZXMgZm9yIHNpbXBsaWNpdHkuJyB9XSk7XHJcbiAgICAgICAgTmFnU3VwcHJlc3Npb25zLmFkZFN0YWNrU3VwcHJlc3Npb25zKHRoaXMsIFt7IGlkOiAnQXdzU29sdXRpb25zLUlBTTUnLCByZWFzb246ICdXaWxkY2FyZCBwZXJtaXNzaW9ucyBhcmUgdXNlZCBmb3IgYnJldml0eSBhbmQgd2l0aGluIGNvbnRyb2xsZWQgc2NvcGUuJyB9XSk7XHJcbiAgICB9XHJcbn0iXX0=